!function(a){"use strict";function b(a,b,c,e){var f=b&&b.prototype instanceof d?b:d,g=Object.create(f.prototype),h=new m(e||[]);return g._invoke=i(a,c,h),g}function c(a,b,c){try{return{type:"normal",arg:a.call(b,c)}}catch(a){return{type:"throw",arg:a}}}function d(){}function e(){}function f(){}function g(a){["next","throw","return"].forEach(function(b){a[b]=function(a){return this._invoke(b,a)}})}function h(a){function b(d,e,f,g){var h=c(a[d],a,e);if("throw"!==h.type){var i=h.arg,j=i.value;return j&&"object"==typeof j&&r.call(j,"__await")?Promise.resolve(j.__await).then(function(a){b("next",a,f,g)},function(a){b("throw",a,f,g)}):Promise.resolve(j).then(function(a){i.value=a,f(i)},g)}g(h.arg)}function d(a,c){function d(){return new Promise(function(d,e){b(a,c,d,e)})}return e=e?e.then(d,d):d()}var e;this._invoke=d}function i(a,b,d){var e=y;return function(f,g){if(e===A)throw new Error("Generator is already running");if(e===B){if("throw"===f)throw g;return o()}for(d.method=f,d.arg=g;;){var h=d.delegate;if(h){var i=j(h,d);if(i){if(i===C)continue;return i}}if("next"===d.method)d.sent=d._sent=d.arg;else if("throw"===d.method){if(e===y)throw e=B,d.arg;d.dispatchException(d.arg)}else"return"===d.method&&d.abrupt("return",d.arg);e=A;var k=c(a,b,d);if("normal"===k.type){if(e=d.done?B:z,k.arg===C)continue;return{value:k.arg,done:d.done}}"throw"===k.type&&(e=B,d.method="throw",d.arg=k.arg)}}}function j(a,b){var d=a.iterator[b.method];if(d===p){if(b.delegate=null,"throw"===b.method){if(a.iterator.return&&(b.method="return",b.arg=p,j(a,b),"throw"===b.method))return C;b.method="throw",b.arg=new TypeError("The iterator does not provide a 'throw' method")}return C}var e=c(d,a.iterator,b.arg);if("throw"===e.type)return b.method="throw",b.arg=e.arg,b.delegate=null,C;var f=e.arg;return f?f.done?(b[a.resultName]=f.value,b.next=a.nextLoc,"return"!==b.method&&(b.method="next",b.arg=p),b.delegate=null,C):f:(b.method="throw",b.arg=new TypeError("iterator result is not an object"),b.delegate=null,C)}function k(a){var b={tryLoc:a[0]};1 in a&&(b.catchLoc=a[1]),2 in a&&(b.finallyLoc=a[2],b.afterLoc=a[3]),this.tryEntries.push(b)}function l(a){var b=a.completion||{};b.type="normal",delete b.arg,a.completion=b}function m(a){this.tryEntries=[{tryLoc:"root"}],a.forEach(k,this),this.reset(!0)}function n(a){if(a){var b=a[t];if(b)return b.call(a);if("function"==typeof a.next)return a;if(!isNaN(a.length)){var c=-1,d=function b(){for(;++c<a.length;)if(r.call(a,c))return b.value=a[c],b.done=!1,b;return b.value=p,b.done=!0,b};return d.next=d}}return{next:o}}function o(){return{value:p,done:!0}}var p,q=Object.prototype,r=q.hasOwnProperty,s="function"==typeof Symbol?Symbol:{},t=s.iterator||"@@iterator",u=s.asyncIterator||"@@asyncIterator",v=s.toStringTag||"@@toStringTag",w="object"==typeof module,x=a.regeneratorRuntime;if(x)return void(w&&(module.exports=x));x=a.regeneratorRuntime=w?module.exports:{},x.wrap=b;var y="suspendedStart",z="suspendedYield",A="executing",B="completed",C={},D={};D[t]=function(){return this};var E=Object.getPrototypeOf,F=E&&E(E(n([])));F&&F!==q&&r.call(F,t)&&(D=F);var G=f.prototype=d.prototype=Object.create(D);e.prototype=G.constructor=f,f.constructor=e,f[v]=e.displayName="GeneratorFunction",x.isGeneratorFunction=function(a){var b="function"==typeof a&&a.constructor;return!!b&&(b===e||"GeneratorFunction"===(b.displayName||b.name))},x.mark=function(a){return Object.setPrototypeOf?Object.setPrototypeOf(a,f):(a.__proto__=f,v in a||(a[v]="GeneratorFunction")),a.prototype=Object.create(G),a},x.awrap=function(a){return{__await:a}},g(h.prototype),h.prototype[u]=function(){return this},x.AsyncIterator=h,x.async=function(a,c,d,e){var f=new h(b(a,c,d,e));return x.isGeneratorFunction(c)?f:f.next().then(function(a){return a.done?a.value:f.next()})},g(G),G[v]="Generator",G[t]=function(){return this},G.toString=function(){return"[object Generator]"},x.keys=function(a){var b=[];for(var c in a)b.push(c);return b.reverse(),function c(){for(;b.length;){var d=b.pop();if(d in a)return c.value=d,c.done=!1,c}return c.done=!0,c}},x.values=n,m.prototype={constructor:m,reset:function(a){if(this.prev=0,this.next=0,this.sent=this._sent=p,this.done=!1,this.delegate=null,this.method="next",this.arg=p,this.tryEntries.forEach(l),!a)for(var b in this)"t"===b.charAt(0)&&r.call(this,b)&&!isNaN(+b.slice(1))&&(this[b]=p)},stop:function(){this.done=!0;var a=this.tryEntries[0],b=a.completion;if("throw"===b.type)throw b.arg;return this.rval},dispatchException:function(a){function b(b,d){return f.type="throw",f.arg=a,c.next=b,d&&(c.method="next",c.arg=p),!!d}if(this.done)throw a;for(var c=this,d=this.tryEntries.length-1;d>=0;--d){var e=this.tryEntries[d],f=e.completion;if("root"===e.tryLoc)return b("end");if(e.tryLoc<=this.prev){var g=r.call(e,"catchLoc"),h=r.call(e,"finallyLoc");if(g&&h){if(this.prev<e.catchLoc)return b(e.catchLoc,!0);if(this.prev<e.finallyLoc)return b(e.finallyLoc)}else if(g){if(this.prev<e.catchLoc)return b(e.catchLoc,!0)}else{if(!h)throw new Error("try statement without catch or finally");if(this.prev<e.finallyLoc)return b(e.finallyLoc)}}}},abrupt:function(a,b){for(var c=this.tryEntries.length-1;c>=0;--c){var d=this.tryEntries[c];if(d.tryLoc<=this.prev&&r.call(d,"finallyLoc")&&this.prev<d.finallyLoc){var e=d;break}}e&&("break"===a||"continue"===a)&&e.tryLoc<=b&&b<=e.finallyLoc&&(e=null);var f=e?e.completion:{};return f.type=a,f.arg=b,e?(this.method="next",this.next=e.finallyLoc,C):this.complete(f)},complete:function(a,b){if("throw"===a.type)throw a.arg;return"break"===a.type||"continue"===a.type?this.next=a.arg:"return"===a.type?(this.rval=this.arg=a.arg,this.method="return",this.next="end"):"normal"===a.type&&b&&(this.next=b),C},finish:function(a){for(var b=this.tryEntries.length-1;b>=0;--b){var c=this.tryEntries[b];if(c.finallyLoc===a)return this.complete(c.completion,c.afterLoc),l(c),C}},catch:function(a){for(var b=this.tryEntries.length-1;b>=0;--b){var c=this.tryEntries[b];if(c.tryLoc===a){var d=c.completion;if("throw"===d.type){var e=d.arg;l(c)}return e}}throw new Error("illegal catch attempt")},delegateYield:function(a,b,c){return this.delegate={iterator:n(a),resultName:b,nextLoc:c},"next"===this.method&&(this.arg=p),C}}}(function(){return this}()||Function("return this")()),function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.SF=a()}}(function(){return function(){function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){return e(b[g][1][a]||a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}return a}()({1:[function(a,b,c){(function(a){function b(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function d(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function e(a){return function(){var b=a.apply(this,arguments);return new Promise(function(a,c){function d(e,f){try{var g=b[e](f),h=g.value}catch(a){return void c(a)}if(!g.done)return Promise.resolve(h).then(function(a){d("next",a)},function(a){d("throw",a)});a(h)}return d("next")})}}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var g=g||function(a,b){var c={},d=c.lib={},e=function(){},f=d.Base={extend:function(a){e.prototype=this;var b=new e;return a&&b.mixIn(a),b.hasOwnProperty("init")||(b.init=function(){b.$super.init.apply(this,arguments)}),b.init.prototype=b,b.$super=this,b},create:function(){var a=this.extend();return a.init.apply(a,arguments),a},init:function(){},mixIn:function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}},g=d.WordArray=f.extend({init:function(a,b){a=this.words=a||[],this.sigBytes=void 0!=b?b:4*a.length},toString:function(a){return(a||i).stringify(this)},concat:function(a){var b=this.words,c=a.words,d=this.sigBytes;if(a=a.sigBytes,this.clamp(),d%4)for(var e=0;e<a;e++)b[d+e>>>2]|=(c[e>>>2]>>>24-e%4*8&255)<<24-(d+e)%4*8;else if(65535<c.length)for(e=0;e<a;e+=4)b[d+e>>>2]=c[e>>>2];else b.push.apply(b,c);return this.sigBytes+=a,this},clamp:function(){var b=this.words,c=this.sigBytes;b[c>>>2]&=4294967295<<32-c%4*8,b.length=a.ceil(c/4)},clone:function(){var a=f.clone.call(this);return a.words=this.words.slice(0),a},random:function(b){for(var c=[],d=0;d<b;d+=4)c.push(4294967296*a.random()|0);return new g.init(c,b)}}),h=c.enc={},i=h.Hex={stringify:function(a){var b=a.words;a=a.sigBytes;for(var c=[],d=0;d<a;d++){var e=b[d>>>2]>>>24-d%4*8&255;c.push((e>>>4).toString(16)),c.push((15&e).toString(16))}return c.join("")},parse:function(a){for(var b=a.length,c=[],d=0;d<b;d+=2)c[d>>>3]|=parseInt(a.substr(d,2),16)<<24-d%8*4;return new g.init(c,b/2)}},j=h.Latin1={stringify:function(a){var b=a.words;a=a.sigBytes;for(var c=[],d=0;d<a;d++)c.push(String.fromCharCode(b[d>>>2]>>>24-d%4*8&255));return c.join("")},parse:function(a){for(var b=a.length,c=[],d=0;d<b;d++)c[d>>>2]|=(255&a.charCodeAt(d))<<24-d%4*8;return new g.init(c,b)}},k=h.Utf8={stringify:function(a){try{return decodeURIComponent(escape(j.stringify(a)))}catch(a){throw Error("Malformed UTF-8 data")}},parse:function(a){return j.parse(unescape(encodeURIComponent(a)))}},l=d.BufferedBlockAlgorithm=f.extend({reset:function(){this._data=new g.init,this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=k.parse(a)),this._data.concat(a),this._nDataBytes+=a.sigBytes},_process:function(b){var c=this._data,d=c.words,e=c.sigBytes,f=this.blockSize,h=e/(4*f),h=b?a.ceil(h):a.max((0|h)-this._minBufferSize,0);if(b=h*f,e=a.min(4*b,e),b){for(var i=0;i<b;i+=f)this._doProcessBlock(d,i);i=d.splice(0,b),c.sigBytes-=e}return new g.init(i,e)},clone:function(){var a=f.clone.call(this);return a._data=this._data.clone(),a},_minBufferSize:0});d.Hasher=l.extend({cfg:f.extend(),init:function(a){this.cfg=this.cfg.extend(a),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(a){return this._append(a),this._process(),this},finalize:function(a){return a&&this._append(a),this._doFinalize()},blockSize:16,_createHelper:function(a){return function(b,c){return new a.init(c).finalize(b)}},_createHmacHelper:function(a){return function(b,c){return new m.HMAC.init(a,c).finalize(b)}}});var m=c.algo={};return c}(Math);!function(){var a=g,b=a.lib.WordArray;a.enc.Base64={stringify:function(a){var b=a.words,c=a.sigBytes,d=this._map;a.clamp(),a=[];for(var e=0;e<c;e+=3)for(var f=(b[e>>>2]>>>24-e%4*8&255)<<16|(b[e+1>>>2]>>>24-(e+1)%4*8&255)<<8|b[e+2>>>2]>>>24-(e+2)%4*8&255,g=0;4>g&&e+.75*g<c;g++)a.push(d.charAt(f>>>6*(3-g)&63));if(b=d.charAt(64))for(;a.length%4;)a.push(b);return a.join("")},parse:function(a){var c=a.length,d=this._map,e=d.charAt(64);e&&-1!=(e=a.indexOf(e))&&(c=e);for(var e=[],f=0,g=0;g<c;g++)if(g%4){var h=d.indexOf(a.charAt(g-1))<<g%4*2,i=d.indexOf(a.charAt(g))>>>6-g%4*2;e[f>>>2]|=(h|i)<<24-f%4*8,f++}return b.create(e,f)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(a){function b(a,b,c,d,e,f,g){return((a=a+(b&c|~b&d)+e+g)<<f|a>>>32-f)+b}function c(a,b,c,d,e,f,g){return((a=a+(b&d|c&~d)+e+g)<<f|a>>>32-f)+b}function d(a,b,c,d,e,f,g){return((a=a+(b^c^d)+e+g)<<f|a>>>32-f)+b}function e(a,b,c,d,e,f,g){return((a=a+(c^(b|~d))+e+g)<<f|a>>>32-f)+b}for(var f=g,h=f.lib,i=h.WordArray,j=h.Hasher,h=f.algo,k=[],l=0;64>l;l++)k[l]=4294967296*a.abs(a.sin(l+1))|0;h=h.MD5=j.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(a,f){for(var g=0;16>g;g++){var h=f+g,i=a[h];a[h]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}var g=this._hash.words,h=a[f+0],i=a[f+1],j=a[f+2],l=a[f+3],m=a[f+4],n=a[f+5],o=a[f+6],p=a[f+7],q=a[f+8],r=a[f+9],s=a[f+10],t=a[f+11],u=a[f+12],v=a[f+13],w=a[f+14],x=a[f+15],y=g[0],z=g[1],A=g[2],B=g[3],y=b(y,z,A,B,h,7,k[0]),B=b(B,y,z,A,i,12,k[1]),A=b(A,B,y,z,j,17,k[2]),z=b(z,A,B,y,l,22,k[3]),y=b(y,z,A,B,m,7,k[4]),B=b(B,y,z,A,n,12,k[5]),A=b(A,B,y,z,o,17,k[6]),z=b(z,A,B,y,p,22,k[7]),y=b(y,z,A,B,q,7,k[8]),B=b(B,y,z,A,r,12,k[9]),A=b(A,B,y,z,s,17,k[10]),z=b(z,A,B,y,t,22,k[11]),y=b(y,z,A,B,u,7,k[12]),B=b(B,y,z,A,v,12,k[13]),A=b(A,B,y,z,w,17,k[14]),z=b(z,A,B,y,x,22,k[15]),y=c(y,z,A,B,i,5,k[16]),B=c(B,y,z,A,o,9,k[17]),A=c(A,B,y,z,t,14,k[18]),z=c(z,A,B,y,h,20,k[19]),y=c(y,z,A,B,n,5,k[20]),B=c(B,y,z,A,s,9,k[21]),A=c(A,B,y,z,x,14,k[22]),z=c(z,A,B,y,m,20,k[23]),y=c(y,z,A,B,r,5,k[24]),B=c(B,y,z,A,w,9,k[25]),A=c(A,B,y,z,l,14,k[26]),z=c(z,A,B,y,q,20,k[27]),y=c(y,z,A,B,v,5,k[28]),B=c(B,y,z,A,j,9,k[29]),A=c(A,B,y,z,p,14,k[30]),z=c(z,A,B,y,u,20,k[31]),y=d(y,z,A,B,n,4,k[32]),B=d(B,y,z,A,q,11,k[33]),A=d(A,B,y,z,t,16,k[34]),z=d(z,A,B,y,w,23,k[35]),y=d(y,z,A,B,i,4,k[36]),B=d(B,y,z,A,m,11,k[37]),A=d(A,B,y,z,p,16,k[38]),z=d(z,A,B,y,s,23,k[39]),y=d(y,z,A,B,v,4,k[40]),B=d(B,y,z,A,h,11,k[41]),A=d(A,B,y,z,l,16,k[42]),z=d(z,A,B,y,o,23,k[43]),y=d(y,z,A,B,r,4,k[44]),B=d(B,y,z,A,u,11,k[45]),A=d(A,B,y,z,x,16,k[46]),z=d(z,A,B,y,j,23,k[47]),y=e(y,z,A,B,h,6,k[48]),B=e(B,y,z,A,p,10,k[49]),A=e(A,B,y,z,w,15,k[50]),z=e(z,A,B,y,n,21,k[51]),y=e(y,z,A,B,u,6,k[52]),B=e(B,y,z,A,l,10,k[53]),A=e(A,B,y,z,s,15,k[54]),z=e(z,A,B,y,i,21,k[55]),y=e(y,z,A,B,q,6,k[56]),B=e(B,y,z,A,x,10,k[57]),A=e(A,B,y,z,o,15,k[58]),z=e(z,A,B,y,v,21,k[59]),y=e(y,z,A,B,m,6,k[60]),B=e(B,y,z,A,t,10,k[61]),A=e(A,B,y,z,j,15,k[62]),z=e(z,A,B,y,r,21,k[63]);g[0]=g[0]+y|0,g[1]=g[1]+z|0,g[2]=g[2]+A|0,g[3]=g[3]+B|0},_doFinalize:function(){var b=this._data,c=b.words,d=8*this._nDataBytes,e=8*b.sigBytes;c[e>>>5]|=128<<24-e%32;var f=a.floor(d/4294967296);for(c[15+(e+64>>>9<<4)]=16711935&(f<<8|f>>>24)|4278255360&(f<<24|f>>>8),c[14+(e+64>>>9<<4)]=16711935&(d<<8|d>>>24)|4278255360&(d<<24|d>>>8),b.sigBytes=4*(c.length+1),this._process(),b=this._hash,c=b.words,d=0;4>d;d++)e=c[d],c[d]=16711935&(e<<8|e>>>24)|4278255360&(e<<24|e>>>8);return b},clone:function(){var a=j.clone.call(this);return a._hash=this._hash.clone(),a}}),f.MD5=j._createHelper(h),f.HmacMD5=j._createHmacHelper(h)}(Math),function(){var a=g,b=a.lib,c=b.Base,d=b.WordArray,b=a.algo,e=b.EvpKDF=c.extend({cfg:c.extend({keySize:4,hasher:b.MD5,iterations:1}),init:function(a){this.cfg=this.cfg.extend(a)},compute:function(a,b){for(var c=this.cfg,e=c.hasher.create(),f=d.create(),g=f.words,h=c.keySize,c=c.iterations;g.length<h;){i&&e.update(i);var i=e.update(a).finalize(b);e.reset();for(var j=1;j<c;j++)i=e.finalize(i),e.reset();f.concat(i)}return f.sigBytes=4*h,f}});a.EvpKDF=function(a,b,c){return e.create(c).compute(a,b)}}(),g.lib.Cipher||function(a){var b=g,c=b.lib,d=c.Base,e=c.WordArray,f=c.BufferedBlockAlgorithm,h=b.enc.Base64,i=b.algo.EvpKDF,j=c.Cipher=f.extend({cfg:d.extend(),createEncryptor:function(a,b){return this.create(this._ENC_XFORM_MODE,a,b)},createDecryptor:function(a,b){return this.create(this._DEC_XFORM_MODE,a,b)},init:function(a,b,c){this.cfg=this.cfg.extend(c),this._xformMode=a,this._key=b,this.reset()},reset:function(){f.reset.call(this),this._doReset()},process:function(a){return this._append(a),this._process()},finalize:function(a){return a&&this._append(a),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(a){return{encrypt:function(b,c,d){return("string"==typeof c?p:o).encrypt(a,b,c,d)},decrypt:function(b,c,d){return("string"==typeof c?p:o).decrypt(a,b,c,d)}}}});c.StreamCipher=j.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var k=b.mode={},l=function(a,b,c){var d=this._iv;d?this._iv=void 0:d=this._prevBlock;for(var e=0;e<c;e++)a[b+e]^=d[e]},m=(c.BlockCipherMode=d.extend({createEncryptor:function(a,b){return this.Encryptor.create(a,b)},createDecryptor:function(a,b){return this.Decryptor.create(a,b)},init:function(a,b){this._cipher=a,this._iv=b}})).extend();m.Encryptor=m.extend({processBlock:function(a,b){var c=this._cipher,d=c.blockSize;l.call(this,a,b,d),c.encryptBlock(a,b),this._prevBlock=a.slice(b,b+d)}}),m.Decryptor=m.extend({processBlock:function(a,b){var c=this._cipher,d=c.blockSize,e=a.slice(b,b+d);c.decryptBlock(a,b),l.call(this,a,b,d),this._prevBlock=e}}),k=k.CBC=m,m=(b.pad={}).Pkcs7={pad:function(a,b){for(var c=4*b,c=c-a.sigBytes%c,d=c<<24|c<<16|c<<8|c,f=[],g=0;g<c;g+=4)f.push(d);c=e.create(f,c),a.concat(c)},unpad:function(a){a.sigBytes-=255&a.words[a.sigBytes-1>>>2]}},c.BlockCipher=j.extend({cfg:j.cfg.extend({mode:k,padding:m}),reset:function(){j.reset.call(this);var a=this.cfg,b=a.iv,a=a.mode;if(this._xformMode==this._ENC_XFORM_MODE)var c=a.createEncryptor;else c=a.createDecryptor,this._minBufferSize=1;this._mode=c.call(a,this,b&&b.words)},_doProcessBlock:function(a,b){this._mode.processBlock(a,b)},_doFinalize:function(){var a=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){a.pad(this._data,this.blockSize);var b=this._process(!0)}else b=this._process(!0),a.unpad(b);return b},blockSize:4});var n=c.CipherParams=d.extend({init:function(a){this.mixIn(a)},toString:function(a){return(a||this.formatter).stringify(this)}}),k=(b.format={}).OpenSSL={stringify:function(a){var b=a.ciphertext;return a=a.salt,(a?e.create([1398893684,1701076831]).concat(a).concat(b):b).toString(h)},parse:function(a){a=h.parse(a);var b=a.words;if(1398893684==b[0]&&1701076831==b[1]){var c=e.create(b.slice(2,4));b.splice(0,4),a.sigBytes-=16}return n.create({ciphertext:a,salt:c})}},o=c.SerializableCipher=d.extend({cfg:d.extend({format:k}),encrypt:function(a,b,c,d){d=this.cfg.extend(d);var e=a.createEncryptor(c,d);return b=e.finalize(b),e=e.cfg,n.create({ciphertext:b,key:c,iv:e.iv,algorithm:a,mode:e.mode,padding:e.padding,blockSize:a.blockSize,formatter:d.format})},decrypt:function(a,b,c,d){return d=this.cfg.extend(d),b=this._parse(b,d.format),a.createDecryptor(c,d).finalize(b.ciphertext)},_parse:function(a,b){return"string"==typeof a?b.parse(a,this):a}}),b=(b.kdf={}).OpenSSL={execute:function(a,b,c,d){return d||(d=e.random(8)),a=i.create({keySize:b+c}).compute(a,d),c=e.create(a.words.slice(b),4*c),a.sigBytes=4*b,n.create({key:a,iv:c,salt:d})}},p=c.PasswordBasedCipher=o.extend({cfg:o.cfg.extend({kdf:b}),encrypt:function(a,b,c,d){return d=this.cfg.extend(d),c=d.kdf.execute(c,a.keySize,a.ivSize),d.iv=c.iv,a=o.encrypt.call(this,a,b,c.key,d),a.mixIn(c),a},decrypt:function(a,b,c,d){return d=this.cfg.extend(d),b=this._parse(b,d.format),c=d.kdf.execute(c,a.keySize,a.ivSize,b.salt),d.iv=c.iv,o.decrypt.call(this,a,b,c.key,d)}})}(),function(){for(var a=g,b=a.lib.BlockCipher,c=a.algo,d=[],e=[],f=[],h=[],i=[],j=[],k=[],l=[],m=[],n=[],o=[],p=0;256>p;p++)o[p]=128>p?p<<1:p<<1^283;for(var q=0,r=0,p=0;256>p;p++){var s=r^r<<1^r<<2^r<<3^r<<4,s=s>>>8^255&s^99;d[q]=s,e[s]=q;var t=o[q],u=o[t],v=o[u],w=257*o[s]^16843008*s;f[q]=w<<24|w>>>8,h[q]=w<<16|w>>>16,i[q]=w<<8|w>>>24,j[q]=w,w=16843009*v^65537*u^257*t^16843008*q,k[s]=w<<24|w>>>8,l[s]=w<<16|w>>>16,m[s]=w<<8|w>>>24,n[s]=w,q?(q=t^o[o[o[v^t]]],r^=o[o[r]]):q=r=1}var x=[0,1,2,4,8,16,32,64,128,27,54],c=c.AES=b.extend({_doReset:function(){for(var a=this._key,b=a.words,c=a.sigBytes/4,a=4*((this._nRounds=c+6)+1),e=this._keySchedule=[],f=0;f<a;f++)if(f<c)e[f]=b[f];else{var g=e[f-1];f%c?6<c&&4==f%c&&(g=d[g>>>24]<<24|d[g>>>16&255]<<16|d[g>>>8&255]<<8|d[255&g]):(g=g<<8|g>>>24,g=d[g>>>24]<<24|d[g>>>16&255]<<16|d[g>>>8&255]<<8|d[255&g],g^=x[f/c|0]<<24),e[f]=e[f-c]^g}for(b=this._invKeySchedule=[],c=0;c<a;c++)f=a-c,g=c%4?e[f]:e[f-4],b[c]=4>c||4>=f?g:k[d[g>>>24]]^l[d[g>>>16&255]]^m[d[g>>>8&255]]^n[d[255&g]]},encryptBlock:function(a,b){this._doCryptBlock(a,b,this._keySchedule,f,h,i,j,d)},decryptBlock:function(a,b){var c=a[b+1];a[b+1]=a[b+3],a[b+3]=c,this._doCryptBlock(a,b,this._invKeySchedule,k,l,m,n,e),c=a[b+1],a[b+1]=a[b+3],a[b+3]=c},_doCryptBlock:function(a,b,c,d,e,f,g,h){for(var i=this._nRounds,j=a[b]^c[0],k=a[b+1]^c[1],l=a[b+2]^c[2],m=a[b+3]^c[3],n=4,o=1;o<i;o++)var p=d[j>>>24]^e[k>>>16&255]^f[l>>>8&255]^g[255&m]^c[n++],q=d[k>>>24]^e[l>>>16&255]^f[m>>>8&255]^g[255&j]^c[n++],r=d[l>>>24]^e[m>>>16&255]^f[j>>>8&255]^g[255&k]^c[n++],m=d[m>>>24]^e[j>>>16&255]^f[k>>>8&255]^g[255&l]^c[n++],j=p,k=q,l=r;p=(h[j>>>24]<<24|h[k>>>16&255]<<16|h[l>>>8&255]<<8|h[255&m])^c[n++],q=(h[k>>>24]<<24|h[l>>>16&255]<<16|h[m>>>8&255]<<8|h[255&j])^c[n++],r=(h[l>>>24]<<24|h[m>>>16&255]<<16|h[j>>>8&255]<<8|h[255&k])^c[n++],m=(h[m>>>24]<<24|h[j>>>16&255]<<16|h[k>>>8&255]<<8|h[255&l])^c[n++],a[b]=p,a[b+1]=q,a[b+2]=r,a[b+3]=m},keySize:8});a.AES=b._createHelper(c)}();var g=g||function(a,b){var c={},d=c.lib={},e=function(){},f=d.Base={extend:function(a){e.prototype=this;var b=new e;return a&&b.mixIn(a),b.hasOwnProperty("init")||(b.init=function(){b.$super.init.apply(this,arguments)}),b.init.prototype=b,b.$super=this,b},create:function(){var a=this.extend();return a.init.apply(a,arguments),a},init:function(){},mixIn:function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}},g=d.WordArray=f.extend({init:function(a,b){a=this.words=a||[],this.sigBytes=void 0!=b?b:4*a.length},toString:function(a){return(a||i).stringify(this)},concat:function(a){var b=this.words,c=a.words,d=this.sigBytes;if(a=a.sigBytes,this.clamp(),d%4)for(var e=0;e<a;e++)b[d+e>>>2]|=(c[e>>>2]>>>24-e%4*8&255)<<24-(d+e)%4*8;else if(65535<c.length)for(e=0;e<a;e+=4)b[d+e>>>2]=c[e>>>2];else b.push.apply(b,c);return this.sigBytes+=a,this},clamp:function(){var b=this.words,c=this.sigBytes;b[c>>>2]&=4294967295<<32-c%4*8,b.length=a.ceil(c/4)},clone:function(){var a=f.clone.call(this);return a.words=this.words.slice(0),a},random:function(b){for(var c=[],d=0;d<b;d+=4)c.push(4294967296*a.random()|0);return new g.init(c,b)}}),h=c.enc={},i=h.Hex={stringify:function(a){var b=a.words;a=a.sigBytes;for(var c=[],d=0;d<a;d++){var e=b[d>>>2]>>>24-d%4*8&255;c.push((e>>>4).toString(16)),c.push((15&e).toString(16))}return c.join("")},parse:function(a){for(var b=a.length,c=[],d=0;d<b;d+=2)c[d>>>3]|=parseInt(a.substr(d,2),16)<<24-d%8*4;return new g.init(c,b/2)}},j=h.Latin1={stringify:function(a){var b=a.words;a=a.sigBytes;for(var c=[],d=0;d<a;d++)c.push(String.fromCharCode(b[d>>>2]>>>24-d%4*8&255));return c.join("")},parse:function(a){for(var b=a.length,c=[],d=0;d<b;d++)c[d>>>2]|=(255&a.charCodeAt(d))<<24-d%4*8;return new g.init(c,b)}},k=h.Utf8={stringify:function(a){try{return decodeURIComponent(escape(j.stringify(a)))}catch(a){throw Error("Malformed UTF-8 data")}},parse:function(a){return j.parse(unescape(encodeURIComponent(a)))}},l=d.BufferedBlockAlgorithm=f.extend({reset:function(){this._data=new g.init,this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=k.parse(a)),this._data.concat(a),this._nDataBytes+=a.sigBytes},_process:function(b){var c=this._data,d=c.words,e=c.sigBytes,f=this.blockSize,h=e/(4*f),h=b?a.ceil(h):a.max((0|h)-this._minBufferSize,0);if(b=h*f,e=a.min(4*b,e),b){for(var i=0;i<b;i+=f)this._doProcessBlock(d,i);i=d.splice(0,b),c.sigBytes-=e}return new g.init(i,e)},clone:function(){var a=f.clone.call(this);return a._data=this._data.clone(),a},_minBufferSize:0});d.Hasher=l.extend({cfg:f.extend(),init:function(a){this.cfg=this.cfg.extend(a),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(a){return this._append(a),this._process(),this},finalize:function(a){return a&&this._append(a),this._doFinalize()},blockSize:16,_createHelper:function(a){return function(b,c){return new a.init(c).finalize(b)}},_createHmacHelper:function(a){return function(b,c){return new m.HMAC.init(a,c).finalize(b)}}});var m=c.algo={};return c}(Math);!function(a){for(var b=g,c=b.lib,d=c.WordArray,e=c.Hasher,c=b.algo,f=[],h=[],i=function(a){return 4294967296*(a-(0|a))|0},j=2,k=0;64>k;){var l;a:{l=j;for(var m=a.sqrt(l),n=2;n<=m;n++)if(!(l%n)){l=!1;break a}l=!0}l&&(8>k&&(f[k]=i(a.pow(j,.5))),h[k]=i(a.pow(j,1/3)),k++),j++}var o=[],c=c.SHA256=e.extend({_doReset:function(){this._hash=new d.init(f.slice(0))},_doProcessBlock:function(a,b){for(var c=this._hash.words,d=c[0],e=c[1],f=c[2],g=c[3],i=c[4],j=c[5],k=c[6],l=c[7],m=0;64>m;m++){if(16>m)o[m]=0|a[b+m];else{var n=o[m-15],p=o[m-2];o[m]=((n<<25|n>>>7)^(n<<14|n>>>18)^n>>>3)+o[m-7]+((p<<15|p>>>17)^(p<<13|p>>>19)^p>>>10)+o[m-16]}n=l+((i<<26|i>>>6)^(i<<21|i>>>11)^(i<<7|i>>>25))+(i&j^~i&k)+h[m]+o[m],p=((d<<30|d>>>2)^(d<<19|d>>>13)^(d<<10|d>>>22))+(d&e^d&f^e&f),l=k,k=j,j=i,i=g+n|0,g=f,f=e,e=d,d=n+p|0}c[0]=c[0]+d|0,c[1]=c[1]+e|0,c[2]=c[2]+f|0,c[3]=c[3]+g|0,c[4]=c[4]+i|0,c[5]=c[5]+j|0,c[6]=c[6]+k|0,c[7]=c[7]+l|0},_doFinalize:function(){var b=this._data,c=b.words,d=8*this._nDataBytes,e=8*b.sigBytes;return c[e>>>5]|=128<<24-e%32,c[14+(e+64>>>9<<4)]=a.floor(d/4294967296),c[15+(e+64>>>9<<4)]=d,b.sigBytes=4*c.length,this._process(),this._hash},clone:function(){var a=e.clone.call(this);return a._hash=this._hash.clone(),a}});b.SHA256=e._createHelper(c),b.HmacSHA256=e._createHmacHelper(c)}(Math),function(){var a=g,b=a.enc.Utf8;a.algo.HMAC=a.lib.Base.extend({init:function(a,c){a=this._hasher=new a.init,"string"==typeof c&&(c=b.parse(c));var d=a.blockSize,e=4*d;c.sigBytes>e&&(c=a.finalize(c)),c.clamp();for(var f=this._oKey=c.clone(),g=this._iKey=c.clone(),h=f.words,i=g.words,j=0;j<d;j++)h[j]^=1549556828,i[j]^=909522486;f.sigBytes=g.sigBytes=e,this.reset()},reset:function(){var a=this._hasher;a.reset(),a.update(this._iKey)},update:function(a){return this._hasher.update(a),this},finalize:function(a){var b=this._hasher;return a=b.finalize(a),b.reset(),b.finalize(this._oKey.clone().concat(a))}})}();var g=g||function(a,b){var c={},d=c.lib={},e=function(){},f=d.Base={extend:function(a){e.prototype=this;var b=new e;return a&&b.mixIn(a),b.hasOwnProperty("init")||(b.init=function(){b.$super.init.apply(this,arguments)}),b.init.prototype=b,b.$super=this,b},create:function(){var a=this.extend();return a.init.apply(a,arguments),a},init:function(){},mixIn:function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}},g=d.WordArray=f.extend({init:function(a,b){a=this.words=a||[],this.sigBytes=void 0!=b?b:4*a.length},toString:function(a){return(a||i).stringify(this)},concat:function(a){var b=this.words,c=a.words,d=this.sigBytes;if(a=a.sigBytes,this.clamp(),d%4)for(var e=0;e<a;e++)b[d+e>>>2]|=(c[e>>>2]>>>24-e%4*8&255)<<24-(d+e)%4*8;else if(65535<c.length)for(e=0;e<a;e+=4)b[d+e>>>2]=c[e>>>2];else b.push.apply(b,c);return this.sigBytes+=a,this},clamp:function(){var b=this.words,c=this.sigBytes;b[c>>>2]&=4294967295<<32-c%4*8,b.length=a.ceil(c/4)},clone:function(){var a=f.clone.call(this);return a.words=this.words.slice(0),a},random:function(b){for(var c=[],d=0;d<b;d+=4)c.push(4294967296*a.random()|0);return new g.init(c,b)}}),h=c.enc={},i=h.Hex={stringify:function(a){var b=a.words;a=a.sigBytes;for(var c=[],d=0;d<a;d++){var e=b[d>>>2]>>>24-d%4*8&255;c.push((e>>>4).toString(16)),c.push((15&e).toString(16))}return c.join("")},parse:function(a){for(var b=a.length,c=[],d=0;d<b;d+=2)c[d>>>3]|=parseInt(a.substr(d,2),16)<<24-d%8*4;return new g.init(c,b/2)}},j=h.Latin1={stringify:function(a){var b=a.words;a=a.sigBytes;for(var c=[],d=0;d<a;d++)c.push(String.fromCharCode(b[d>>>2]>>>24-d%4*8&255));return c.join("")},parse:function(a){for(var b=a.length,c=[],d=0;d<b;d++)c[d>>>2]|=(255&a.charCodeAt(d))<<24-d%4*8;return new g.init(c,b)}},k=h.Utf8={stringify:function(a){try{return decodeURIComponent(escape(j.stringify(a)))}catch(a){throw Error("Malformed UTF-8 data")}},parse:function(a){return j.parse(unescape(encodeURIComponent(a)))}},l=d.BufferedBlockAlgorithm=f.extend({reset:function(){this._data=new g.init,this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=k.parse(a)),this._data.concat(a),this._nDataBytes+=a.sigBytes},_process:function(b){var c=this._data,d=c.words,e=c.sigBytes,f=this.blockSize,h=e/(4*f),h=b?a.ceil(h):a.max((0|h)-this._minBufferSize,0);if(b=h*f,e=a.min(4*b,e),b){for(var i=0;i<b;i+=f)this._doProcessBlock(d,i);i=d.splice(0,b),c.sigBytes-=e}return new g.init(i,e)},clone:function(){var a=f.clone.call(this);return a._data=this._data.clone(),a},_minBufferSize:0});d.Hasher=l.extend({cfg:f.extend(),init:function(a){this.cfg=this.cfg.extend(a),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(a){return this._append(a),this._process(),this},finalize:function(a){return a&&this._append(a),this._doFinalize()},blockSize:16,_createHelper:function(a){return function(b,c){return new a.init(c).finalize(b)}},_createHmacHelper:function(a){return function(b,c){return new m.HMAC.init(a,c).finalize(b)}}});var m=c.algo={};return c}(Math);!function(a){var b=g,c=b.lib,d=c.Base,e=c.WordArray,b=b.x64={};b.Word=d.extend({init:function(a,b){this.high=a,this.low=b}}),b.WordArray=d.extend({init:function(a,b){a=this.words=a||[],this.sigBytes=void 0!=b?b:8*a.length},toX32:function(){for(var a=this.words,b=a.length,c=[],d=0;d<b;d++){var f=a[d];c.push(f.high),c.push(f.low)}return e.create(c,this.sigBytes)},clone:function(){for(var a=d.clone.call(this),b=a.words=this.words.slice(0),c=b.length,e=0;e<c;e++)b[e]=b[e].clone();return a}})}(),function(){function a(){return e.create.apply(e,arguments)}for(var b=g,c=b.lib.Hasher,d=b.x64,e=d.Word,f=d.WordArray,d=b.algo,h=[a(1116352408,3609767458),a(1899447441,602891725),a(3049323471,3964484399),a(3921009573,2173295548),a(961987163,4081628472),a(1508970993,3053834265),a(2453635748,2937671579),a(2870763221,3664609560),a(3624381080,2734883394),a(310598401,1164996542),a(607225278,1323610764),a(1426881987,3590304994),a(1925078388,4068182383),a(2162078206,991336113),a(2614888103,633803317),a(3248222580,3479774868),a(3835390401,2666613458),a(4022224774,944711139),a(264347078,2341262773),a(604807628,2007800933),a(770255983,1495990901),a(1249150122,1856431235),a(1555081692,3175218132),a(1996064986,2198950837),a(2554220882,3999719339),a(2821834349,766784016),a(2952996808,2566594879),a(3210313671,3203337956),a(3336571891,1034457026),a(3584528711,2466948901),a(113926993,3758326383),a(338241895,168717936),a(666307205,1188179964),a(773529912,1546045734),a(1294757372,1522805485),a(1396182291,2643833823),a(1695183700,2343527390),a(1986661051,1014477480),a(2177026350,1206759142),a(2456956037,344077627),a(2730485921,1290863460),a(2820302411,3158454273),a(3259730800,3505952657),a(3345764771,106217008),a(3516065817,3606008344),a(3600352804,1432725776),a(4094571909,1467031594),a(275423344,851169720),a(430227734,3100823752),a(506948616,1363258195),a(659060556,3750685593),a(883997877,3785050280),a(958139571,3318307427),a(1322822218,3812723403),a(1537002063,2003034995),a(1747873779,3602036899),a(1955562222,1575990012),a(2024104815,1125592928),a(2227730452,2716904306),a(2361852424,442776044),a(2428436474,593698344),a(2756734187,3733110249),a(3204031479,2999351573),a(3329325298,3815920427),a(3391569614,3928383900),a(3515267271,566280711),a(3940187606,3454069534),a(4118630271,4000239992),a(116418474,1914138554),a(174292421,2731055270),a(289380356,3203993006),a(460393269,320620315),a(685471733,587496836),a(852142971,1086792851),a(1017036298,365543100),a(1126000580,2618297676),a(1288033470,3409855158),a(1501505948,4234509866),a(1607167915,987167468),a(1816402316,1246189591)],i=[],j=0;80>j;j++)i[j]=a();d=d.SHA512=c.extend({_doReset:function(){
this._hash=new f.init([new e.init(1779033703,4089235720),new e.init(3144134277,2227873595),new e.init(1013904242,4271175723),new e.init(2773480762,1595750129),new e.init(1359893119,2917565137),new e.init(2600822924,725511199),new e.init(528734635,4215389547),new e.init(1541459225,327033209)])},_doProcessBlock:function(a,b){for(var c=this._hash.words,d=c[0],e=c[1],f=c[2],g=c[3],j=c[4],k=c[5],l=c[6],c=c[7],m=d.high,n=d.low,o=e.high,p=e.low,q=f.high,r=f.low,s=g.high,t=g.low,u=j.high,v=j.low,w=k.high,x=k.low,y=l.high,z=l.low,A=c.high,B=c.low,C=m,D=n,E=o,F=p,G=q,H=r,I=s,J=t,K=u,L=v,M=w,N=x,O=y,P=z,Q=A,R=B,S=0;80>S;S++){var T=i[S];if(16>S)var U=T.high=0|a[b+2*S],V=T.low=0|a[b+2*S+1];else{var U=i[S-15],V=U.high,W=U.low,U=(V>>>1|W<<31)^(V>>>8|W<<24)^V>>>7,W=(W>>>1|V<<31)^(W>>>8|V<<24)^(W>>>7|V<<25),X=i[S-2],V=X.high,Y=X.low,X=(V>>>19|Y<<13)^(V<<3|Y>>>29)^V>>>6,Y=(Y>>>19|V<<13)^(Y<<3|V>>>29)^(Y>>>6|V<<26),V=i[S-7],Z=V.high,$=i[S-16],_=$.high,$=$.low,V=W+V.low,U=U+Z+(V>>>0<W>>>0?1:0),V=V+Y,U=U+X+(V>>>0<Y>>>0?1:0),V=V+$,U=U+_+(V>>>0<$>>>0?1:0);T.high=U,T.low=V}var Z=K&M^~K&O,$=L&N^~L&P,T=C&E^C&G^E&G,aa=D&F^D&H^F&H,W=(C>>>28|D<<4)^(C<<30|D>>>2)^(C<<25|D>>>7),X=(D>>>28|C<<4)^(D<<30|C>>>2)^(D<<25|C>>>7),Y=h[S],ba=Y.high,ca=Y.low,Y=R+((L>>>14|K<<18)^(L>>>18|K<<14)^(L<<23|K>>>9)),_=Q+((K>>>14|L<<18)^(K>>>18|L<<14)^(K<<23|L>>>9))+(Y>>>0<R>>>0?1:0),Y=Y+$,_=_+Z+(Y>>>0<$>>>0?1:0),Y=Y+ca,_=_+ba+(Y>>>0<ca>>>0?1:0),Y=Y+V,_=_+U+(Y>>>0<V>>>0?1:0),V=X+aa,T=W+T+(V>>>0<X>>>0?1:0),Q=O,R=P,O=M,P=N,M=K,N=L,L=J+Y|0,K=I+_+(L>>>0<J>>>0?1:0)|0,I=G,J=H,G=E,H=F,E=C,F=D,D=Y+V|0,C=_+T+(D>>>0<Y>>>0?1:0)|0}n=d.low=n+D,d.high=m+C+(n>>>0<D>>>0?1:0),p=e.low=p+F,e.high=o+E+(p>>>0<F>>>0?1:0),r=f.low=r+H,f.high=q+G+(r>>>0<H>>>0?1:0),t=g.low=t+J,g.high=s+I+(t>>>0<J>>>0?1:0),v=j.low=v+L,j.high=u+K+(v>>>0<L>>>0?1:0),x=k.low=x+N,k.high=w+M+(x>>>0<N>>>0?1:0),z=l.low=z+P,l.high=y+O+(z>>>0<P>>>0?1:0),B=c.low=B+R,c.high=A+Q+(B>>>0<R>>>0?1:0)},_doFinalize:function(){var a=this._data,b=a.words,c=8*this._nDataBytes,d=8*a.sigBytes;return b[d>>>5]|=128<<24-d%32,b[30+(d+128>>>10<<5)]=Math.floor(c/4294967296),b[31+(d+128>>>10<<5)]=c,a.sigBytes=4*b.length,this._process(),this._hash.toX32()},clone:function(){var a=c.clone.call(this);return a._hash=this._hash.clone(),a},blockSize:32}),b.SHA512=c._createHelper(d),b.HmacSHA512=c._createHmacHelper(d)}(),function(){var a=g,b=a.enc.Utf8;a.algo.HMAC=a.lib.Base.extend({init:function(a,c){a=this._hasher=new a.init,"string"==typeof c&&(c=b.parse(c));var d=a.blockSize,e=4*d;c.sigBytes>e&&(c=a.finalize(c)),c.clamp();for(var f=this._oKey=c.clone(),g=this._iKey=c.clone(),h=f.words,i=g.words,j=0;j<d;j++)h[j]^=1549556828,i[j]^=909522486;f.sigBytes=g.sigBytes=e,this.reset()},reset:function(){var a=this._hasher;a.reset(),a.update(this._iKey)},update:function(a){return this._hasher.update(a),this},finalize:function(a){var b=this._hasher;return a=b.finalize(a),b.reset(),b.finalize(this._oKey.clone().concat(a))}})}();var g=g||function(a,b){var c={},d=c.lib={},e=function(){},f=d.Base={extend:function(a){e.prototype=this;var b=new e;return a&&b.mixIn(a),b.hasOwnProperty("init")||(b.init=function(){b.$super.init.apply(this,arguments)}),b.init.prototype=b,b.$super=this,b},create:function(){var a=this.extend();return a.init.apply(a,arguments),a},init:function(){},mixIn:function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}},g=d.WordArray=f.extend({init:function(a,b){a=this.words=a||[],this.sigBytes=void 0!=b?b:4*a.length},toString:function(a){return(a||i).stringify(this)},concat:function(a){var b=this.words,c=a.words,d=this.sigBytes;if(a=a.sigBytes,this.clamp(),d%4)for(var e=0;e<a;e++)b[d+e>>>2]|=(c[e>>>2]>>>24-e%4*8&255)<<24-(d+e)%4*8;else if(65535<c.length)for(e=0;e<a;e+=4)b[d+e>>>2]=c[e>>>2];else b.push.apply(b,c);return this.sigBytes+=a,this},clamp:function(){var b=this.words,c=this.sigBytes;b[c>>>2]&=4294967295<<32-c%4*8,b.length=a.ceil(c/4)},clone:function(){var a=f.clone.call(this);return a.words=this.words.slice(0),a},random:function(b){for(var c=[],d=0;d<b;d+=4)c.push(4294967296*a.random()|0);return new g.init(c,b)}}),h=c.enc={},i=h.Hex={stringify:function(a){var b=a.words;a=a.sigBytes;for(var c=[],d=0;d<a;d++){var e=b[d>>>2]>>>24-d%4*8&255;c.push((e>>>4).toString(16)),c.push((15&e).toString(16))}return c.join("")},parse:function(a){for(var b=a.length,c=[],d=0;d<b;d+=2)c[d>>>3]|=parseInt(a.substr(d,2),16)<<24-d%8*4;return new g.init(c,b/2)}},j=h.Latin1={stringify:function(a){var b=a.words;a=a.sigBytes;for(var c=[],d=0;d<a;d++)c.push(String.fromCharCode(b[d>>>2]>>>24-d%4*8&255));return c.join("")},parse:function(a){for(var b=a.length,c=[],d=0;d<b;d++)c[d>>>2]|=(255&a.charCodeAt(d))<<24-d%4*8;return new g.init(c,b)}},k=h.Utf8={stringify:function(a){try{return decodeURIComponent(escape(j.stringify(a)))}catch(a){throw Error("Malformed UTF-8 data")}},parse:function(a){return j.parse(unescape(encodeURIComponent(a)))}},l=d.BufferedBlockAlgorithm=f.extend({reset:function(){this._data=new g.init,this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=k.parse(a)),this._data.concat(a),this._nDataBytes+=a.sigBytes},_process:function(b){var c=this._data,d=c.words,e=c.sigBytes,f=this.blockSize,h=e/(4*f),h=b?a.ceil(h):a.max((0|h)-this._minBufferSize,0);if(b=h*f,e=a.min(4*b,e),b){for(var i=0;i<b;i+=f)this._doProcessBlock(d,i);i=d.splice(0,b),c.sigBytes-=e}return new g.init(i,e)},clone:function(){var a=f.clone.call(this);return a._data=this._data.clone(),a},_minBufferSize:0});d.Hasher=l.extend({cfg:f.extend(),init:function(a){this.cfg=this.cfg.extend(a),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(a){return this._append(a),this._process(),this},finalize:function(a){return a&&this._append(a),this._doFinalize()},blockSize:16,_createHelper:function(a){return function(b,c){return new a.init(c).finalize(b)}},_createHmacHelper:function(a){return function(b,c){return new m.HMAC.init(a,c).finalize(b)}}});var m=c.algo={};return c}(Math);!function(){var a=g,b=a.lib,c=b.WordArray,d=b.Hasher,e=[],b=a.algo.SHA1=d.extend({_doReset:function(){this._hash=new c.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(a,b){for(var c=this._hash.words,d=c[0],f=c[1],g=c[2],h=c[3],i=c[4],j=0;80>j;j++){if(16>j)e[j]=0|a[b+j];else{var k=e[j-3]^e[j-8]^e[j-14]^e[j-16];e[j]=k<<1|k>>>31}k=(d<<5|d>>>27)+i+e[j],k=20>j?k+(1518500249+(f&g|~f&h)):40>j?k+(1859775393+(f^g^h)):60>j?k+((f&g|f&h|g&h)-1894007588):k+((f^g^h)-899497514),i=h,h=g,g=f<<30|f>>>2,f=d,d=k}c[0]=c[0]+d|0,c[1]=c[1]+f|0,c[2]=c[2]+g|0,c[3]=c[3]+h|0,c[4]=c[4]+i|0},_doFinalize:function(){var a=this._data,b=a.words,c=8*this._nDataBytes,d=8*a.sigBytes;return b[d>>>5]|=128<<24-d%32,b[14+(d+64>>>9<<4)]=Math.floor(c/4294967296),b[15+(d+64>>>9<<4)]=c,a.sigBytes=4*b.length,this._process(),this._hash},clone:function(){var a=d.clone.call(this);return a._hash=this._hash.clone(),a}});a.SHA1=d._createHelper(b),a.HmacSHA1=d._createHmacHelper(b)}(),function(){var a=g,b=a.enc.Utf8;a.algo.HMAC=a.lib.Base.extend({init:function(a,c){a=this._hasher=new a.init,"string"==typeof c&&(c=b.parse(c));var d=a.blockSize,e=4*d;c.sigBytes>e&&(c=a.finalize(c)),c.clamp();for(var f=this._oKey=c.clone(),g=this._iKey=c.clone(),h=f.words,i=g.words,j=0;j<d;j++)h[j]^=1549556828,i[j]^=909522486;f.sigBytes=g.sigBytes=e,this.reset()},reset:function(){var a=this._hasher;a.reset(),a.update(this._iKey)},update:function(a){return this._hasher.update(a),this},finalize:function(a){var b=this._hasher;return a=b.finalize(a),b.reset(),b.finalize(this._oKey.clone().concat(a))}})}(),function(){var a=g,b=a.lib,c=b.Base,d=b.WordArray,b=a.algo,e=b.HMAC,f=b.PBKDF2=c.extend({cfg:c.extend({keySize:4,hasher:b.SHA1,iterations:1}),init:function(a){this.cfg=this.cfg.extend(a)},compute:function(a,b){for(var c=this.cfg,f=e.create(c.hasher,a),g=d.create(),h=d.create([1]),i=g.words,j=h.words,k=c.keySize,c=c.iterations;i.length<k;){var l=f.update(b).finalize(h);f.reset();for(var m=l.words,n=m.length,o=l,p=1;p<c;p++){o=f.finalize(o),f.reset();for(var q=o.words,r=0;r<n;r++)m[r]^=q[r]}g.concat(l),j[0]++}return g.sigBytes=4*k,g}});a.PBKDF2=function(a,b,c){return f.create(c).compute(a,b)}}();var g=g||function(a,b){var c={},d=c.lib={},e=function(){},f=d.Base={extend:function(a){e.prototype=this;var b=new e;return a&&b.mixIn(a),b.hasOwnProperty("init")||(b.init=function(){b.$super.init.apply(this,arguments)}),b.init.prototype=b,b.$super=this,b},create:function(){var a=this.extend();return a.init.apply(a,arguments),a},init:function(){},mixIn:function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}},g=d.WordArray=f.extend({init:function(a,b){a=this.words=a||[],this.sigBytes=void 0!=b?b:4*a.length},toString:function(a){return(a||i).stringify(this)},concat:function(a){var b=this.words,c=a.words,d=this.sigBytes;if(a=a.sigBytes,this.clamp(),d%4)for(var e=0;e<a;e++)b[d+e>>>2]|=(c[e>>>2]>>>24-e%4*8&255)<<24-(d+e)%4*8;else if(65535<c.length)for(e=0;e<a;e+=4)b[d+e>>>2]=c[e>>>2];else b.push.apply(b,c);return this.sigBytes+=a,this},clamp:function(){var b=this.words,c=this.sigBytes;b[c>>>2]&=4294967295<<32-c%4*8,b.length=a.ceil(c/4)},clone:function(){var a=f.clone.call(this);return a.words=this.words.slice(0),a},random:function(b){for(var c=[],d=0;d<b;d+=4)c.push(4294967296*a.random()|0);return new g.init(c,b)}}),h=c.enc={},i=h.Hex={stringify:function(a){var b=a.words;a=a.sigBytes;for(var c=[],d=0;d<a;d++){var e=b[d>>>2]>>>24-d%4*8&255;c.push((e>>>4).toString(16)),c.push((15&e).toString(16))}return c.join("")},parse:function(a){for(var b=a.length,c=[],d=0;d<b;d+=2)c[d>>>3]|=parseInt(a.substr(d,2),16)<<24-d%8*4;return new g.init(c,b/2)}},j=h.Latin1={stringify:function(a){var b=a.words;a=a.sigBytes;for(var c=[],d=0;d<a;d++)c.push(String.fromCharCode(b[d>>>2]>>>24-d%4*8&255));return c.join("")},parse:function(a){for(var b=a.length,c=[],d=0;d<b;d++)c[d>>>2]|=(255&a.charCodeAt(d))<<24-d%4*8;return new g.init(c,b)}},k=h.Utf8={stringify:function(a){try{return decodeURIComponent(escape(j.stringify(a)))}catch(a){throw Error("Malformed UTF-8 data")}},parse:function(a){return j.parse(unescape(encodeURIComponent(a)))}},l=d.BufferedBlockAlgorithm=f.extend({reset:function(){this._data=new g.init,this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=k.parse(a)),this._data.concat(a),this._nDataBytes+=a.sigBytes},_process:function(b){var c=this._data,d=c.words,e=c.sigBytes,f=this.blockSize,h=e/(4*f),h=b?a.ceil(h):a.max((0|h)-this._minBufferSize,0);if(b=h*f,e=a.min(4*b,e),b){for(var i=0;i<b;i+=f)this._doProcessBlock(d,i);i=d.splice(0,b),c.sigBytes-=e}return new g.init(i,e)},clone:function(){var a=f.clone.call(this);return a._data=this._data.clone(),a},_minBufferSize:0});d.Hasher=l.extend({cfg:f.extend(),init:function(a){this.cfg=this.cfg.extend(a),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(a){return this._append(a),this._process(),this},finalize:function(a){return a&&this._append(a),this._doFinalize()},blockSize:16,_createHelper:function(a){return function(b,c){return new a.init(c).finalize(b)}},_createHmacHelper:function(a){return function(b,c){return new m.HMAC.init(a,c).finalize(b)}}});var m=c.algo={};return c}(Math);!function(){var a=g,b=a.lib,c=b.WordArray,d=b.Hasher,e=[],b=a.algo.SHA1=d.extend({_doReset:function(){this._hash=new c.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(a,b){for(var c=this._hash.words,d=c[0],f=c[1],g=c[2],h=c[3],i=c[4],j=0;80>j;j++){if(16>j)e[j]=0|a[b+j];else{var k=e[j-3]^e[j-8]^e[j-14]^e[j-16];e[j]=k<<1|k>>>31}k=(d<<5|d>>>27)+i+e[j],k=20>j?k+(1518500249+(f&g|~f&h)):40>j?k+(1859775393+(f^g^h)):60>j?k+((f&g|f&h|g&h)-1894007588):k+((f^g^h)-899497514),i=h,h=g,g=f<<30|f>>>2,f=d,d=k}c[0]=c[0]+d|0,c[1]=c[1]+f|0,c[2]=c[2]+g|0,c[3]=c[3]+h|0,c[4]=c[4]+i|0},_doFinalize:function(){var a=this._data,b=a.words,c=8*this._nDataBytes,d=8*a.sigBytes;return b[d>>>5]|=128<<24-d%32,b[14+(d+64>>>9<<4)]=Math.floor(c/4294967296),b[15+(d+64>>>9<<4)]=c,a.sigBytes=4*b.length,this._process(),this._hash},clone:function(){var a=d.clone.call(this);return a._hash=this._hash.clone(),a}});a.SHA1=d._createHelper(b),a.HmacSHA1=d._createHmacHelper(b)}(),Object.defineProperty(c,"__esModule",{value:!0});var h,i=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(a){e=!0,f=a}finally{try{!d&&h.return&&h.return()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},k=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),l=c.SFAlertManager=function(){function a(){f(this,a)}return k(a,[{key:"alert",value:function(){function a(a){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(b){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",new Promise(function(a,c){window.alert(b.text),a()}));case 1:case"end":return a.stop()}},a,this)}));return a}()},{key:"confirm",value:function(){function a(a){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(b){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",new Promise(function(a,c){window.confirm(b.text)?a():c()}));case 1:case"end":return a.stop()}},a,this)}));return a}()}]),a}(),m=c.SFAuthManager=function(){function a(b,c,d,e){f(this,a),a.DidSignOutEvent="DidSignOutEvent",a.WillSignInEvent="WillSignInEvent",a.DidSignInEvent="DidSignInEvent",this.httpManager=c,this.storageManager=b,this.alertManager=d||new l,this.$timeout=e||setTimeout.bind(window),this.eventHandlers=[]}return k(a,[{key:"addEventHandler",value:function(a){return this.eventHandlers.push(a),a}},{key:"removeEventHandler",value:function(a){_.pull(this.eventHandlers,a)}},{key:"notifyEvent",value:function(a,b){var c=!0,d=!1,e=void 0;try{for(var f,g=this.eventHandlers[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){(0,f.value)(a,b||{})}}catch(a){d=!0,e=a}finally{try{!c&&g.return&&g.return()}finally{if(d)throw e}}}},{key:"saveKeys",value:function(){function a(a){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(b){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return this._keys=b,a.next=3,this.storageManager.setItem("mk",b.mk);case 3:return a.next=5,this.storageManager.setItem("ak",b.ak);case 5:case"end":return a.stop()}},a,this)}));return a}()},{key:"signout",value:function(){function b(a){return c.apply(this,arguments)}var c=e(regeneratorRuntime.mark(function b(c){var d=this;return regeneratorRuntime.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(this._keys=null,this._authParams=null,!c){b.next=6;break}return b.abrupt("return",this.storageManager.clearAllData().then(function(){d.notifyEvent(a.DidSignOutEvent)}));case 6:this.notifyEvent(a.DidSignOutEvent);case 7:case"end":return b.stop()}},b,this)}));return b}()},{key:"keys",value:function(){function a(){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(){var b;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(this._keys){a.next=11;break}return a.next=3,this.storageManager.getItem("mk");case 3:if(b=a.sent){a.next=6;break}return a.abrupt("return",null);case 6:return a.t0=b,a.next=9,this.storageManager.getItem("ak");case 9:a.t1=a.sent,this._keys={mk:a.t0,ak:a.t1};case 11:return a.abrupt("return",this._keys);case 12:case"end":return a.stop()}},a,this)}));return a}()},{key:"getAuthParams",value:function(){function a(){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(){var b;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(this._authParams){a.next=5;break}return a.next=3,this.storageManager.getItem("auth_params");case 3:b=a.sent,this._authParams=JSON.parse(b);case 5:if(!this._authParams||this._authParams.version){a.next=9;break}return a.next=8,this.defaultProtocolVersion();case 8:this._authParams.version=a.sent;case 9:return a.abrupt("return",this._authParams);case 10:case"end":return a.stop()}},a,this)}));return a}()},{key:"defaultProtocolVersion",value:function(){function a(){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(){var b;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.keys();case 2:if(!(b=a.sent)||!b.ak){a.next=7;break}return a.abrupt("return","002");case 7:return a.abrupt("return","001");case 8:case"end":return a.stop()}},a,this)}));return a}()},{key:"protocolVersion",value:function(){function a(){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(){var b;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.getAuthParams();case 2:if(!(b=a.sent)||!b.version){a.next=5;break}return a.abrupt("return",b.version);case 5:return a.abrupt("return",this.defaultProtocolVersion());case 6:case"end":return a.stop()}},a,this)}));return a}()},{key:"getAuthParamsForEmail",value:function(){function a(a,c,d){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(b,c,d){var e=this;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",new Promise(function(a,f){var g=b+"/auth/params";e.httpManager.getAbsolute(g,_.merge({email:c},d),function(b){a(b)},function(b){console.error("Error getting auth params",b),"object"!==(void 0===b?"undefined":j(b))&&(b={error:{message:"A server error occurred while trying to sign in. Please try again."}}),a(b)})}));case 1:case"end":return a.stop()}},a,this)}));return a}()},{key:"login",value:function(){function b(a,b,d,e,f){return c.apply(this,arguments)}var c=e(regeneratorRuntime.mark(function b(c,d,f,g,h){var i=this;return regeneratorRuntime.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.abrupt("return",new Promise(function(){var b=e(regeneratorRuntime.mark(function b(k,l){var m,n,o,p,q,r,s,t,u,v,w,x;return regeneratorRuntime.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return i.notifyEvent(a.WillSignInEvent),b.next=3,i.getAuthParamsForEmail(c,d,h);case 3:if(m=b.sent,m.identifier=d,!m.error){b.next=8;break}return k(m),b.abrupt("return");case 8:if(m&&m.pw_cost){b.next=11;break}return k({error:{message:"Invalid email or password."}}),b.abrupt("return");case 11:if(SFJS.supportedVersions().includes(m.version)){b.next=15;break}return n=SFJS.isVersionNewerThanLibraryVersion(m.version)?"This version of the application does not support your newer account type. Please upgrade to the latest version of Standard Notes to sign in.":"The protocol version associated with your account is outdated and no longer supported by this application. Please visit standardnotes.org/help/security for more information.",k({error:{message:n}}),b.abrupt("return");case 15:if(!SFJS.isProtocolVersionOutdated(m.version)){b.next=22;break}return o="The encryption version for your account, "+m.version+", is outdated and requires upgrade. You may proceed with login, but are advised to perform a security update using the web or desktop application. Please visit standardnotes.org/help/security for more information.",p=!1,b.next=20,i.alertManager.confirm({title:"Update Needed",text:o,confirmButtonText:"Sign In"}).catch(function(){k({error:{}}),p=!0});case 20:if(!p){b.next=22;break}return b.abrupt("return");case 22:if(SFJS.supportsPasswordDerivationCost(m.pw_cost)){b.next=26;break}return q="Your account was created on a platform with higher security capabilities than this browser supports. If we attempted to generate your login keys here, it would take hours. Please use a browser with more up to date security capabilities, like Google Chrome or Firefox, to log in.",k({error:{message:q}}),b.abrupt("return");case 26:if(r=SFJS.costMinimumForVersion(m.version),!(m.pw_cost<r)){b.next=31;break}return s="Unable to login due to insecure password parameters. Please visit standardnotes.org/help/security for more information.",k({error:{message:s}}),b.abrupt("return");case 31:if(!g){b.next=37;break}if(t=SFJS.version(),m.version===t){b.next=37;break}return u="Strict sign in refused server sign in parameters. The latest security version is "+t+", but your account is reported to have version "+m.version+". If you'd like to proceed with sign in anyway, please disable strict sign in and try again.",k({error:{message:u}}),b.abrupt("return");case 37:return b.next=39,SFJS.crypto.computeEncryptionKeysForUser(f,m);case 39:v=b.sent,w=c+"/auth/sign_in",x=_.merge({password:v.pw,email:d},h),i.httpManager.postAbsolute(w,x,function(){var b=e(regeneratorRuntime.mark(function b(e){return regeneratorRuntime.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return i.notifyEvent(a.DidSignInEvent),b.next=3,i.handleAuthResponse(e,d,c,m,v);case 3:i.$timeout(function(){return k(e)});case 4:case"end":return b.stop()}},b,i)}));return function(a){return b.apply(this,arguments)}}(),function(a){console.error("Error logging in",a),"object"!==(void 0===a?"undefined":j(a))&&(a={error:{message:"A server error occurred while trying to sign in. Please try again."}}),i.$timeout(function(){return k(a)})});case 43:case"end":return b.stop()}},b,i)}));return function(a,c){return b.apply(this,arguments)}}()));case 1:case"end":return b.stop()}},b,this)}));return b}()},{key:"register",value:function(a,b,c){var d=this;return new Promise(function(){var f=e(regeneratorRuntime.mark(function f(g,h){var i,k,l,m,n;return regeneratorRuntime.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,SFJS.crypto.generateInitialKeysAndAuthParamsForUser(b,c);case 2:i=f.sent,k=i.keys,l=i.authParams,m=a+"/auth",n=_.merge({password:k.pw,email:b},l),d.httpManager.postAbsolute(m,n,function(){var c=e(regeneratorRuntime.mark(function c(e){return regeneratorRuntime.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,d.handleAuthResponse(e,b,a,l,k);case 2:g(e);case 3:case"end":return c.stop()}},c,d)}));return function(a){return c.apply(this,arguments)}}(),function(a){console.error("Registration error",a),"object"!==(void 0===a?"undefined":j(a))&&(a={error:{message:"A server error occurred while trying to register. Please try again."}}),g(a)});case 8:case"end":return f.stop()}},f,d)}));return function(a,b){return f.apply(this,arguments)}}())}},{key:"changePassword",value:function(){function a(a,c,d,e,f){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(b,c,d,f,g){var h=this;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",new Promise(function(){var a=e(regeneratorRuntime.mark(function a(i,k){var l,m,n;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:l=f.pw,m=b+"/auth/change_pw",n=_.merge({new_password:l,current_password:d},g),h.httpManager.postAbsolute(m,n,function(){var a=e(regeneratorRuntime.mark(function a(b){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,h.handleAuthResponse(b,c,null,g,f);case 2:i(b);case 3:case"end":return a.stop()}},a,h)}));return function(b){return a.apply(this,arguments)}}(),function(a){"object"!==(void 0===a?"undefined":j(a))&&(a={error:{message:"Something went wrong while changing your password. Your password was not changed. Please try again."}}),i(a)});case 4:case"end":return a.stop()}},a,h)}));return function(b,c){return a.apply(this,arguments)}}()));case 1:case"end":return a.stop()}},a,this)}));return a}()},{key:"handleAuthResponse",value:function(){function a(a,c,d,e,f){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(b,c,d,e,f){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!d){a.next=3;break}return a.next=3,this.storageManager.setItem("server",d);case 3:return this._authParams=e,a.next=6,this.storageManager.setItem("auth_params",JSON.stringify(e));case 6:return a.next=8,this.storageManager.setItem("jwt",b.token);case 8:return a.abrupt("return",this.saveKeys(f));case 9:case"end":return a.stop()}},a,this)}));return a}()}]),a}(),n="undefined"!=typeof window?window:void 0!==a?a:null,o=c.SFHttpManager=function(){function a(b){f(this,a),this.$timeout=b||setTimeout.bind(n)}return k(a,[{key:"setJWTRequestHandler",value:function(a){this.jwtRequestHandler=a}},{key:"setAuthHeadersForRequest",value:function(){function a(a){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(b){var c;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.jwtRequestHandler();case 2:c=a.sent,c&&b.setRequestHeader("Authorization","Bearer "+c);case 4:case"end":return a.stop()}},a,this)}));return a}()},{key:"postAbsolute",value:function(a,b,c,d){this.httpRequest("post",a,b,c,d)}},{key:"patchAbsolute",value:function(a,b,c,d){this.httpRequest("patch",a,b,c,d)}},{key:"getAbsolute",value:function(a,b,c,d){this.httpRequest("get",a,b,c,d)}},{key:"httpRequest",value:function(){function a(a,c,d,e,f){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(b,c,d,e,f){var g;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return g=new XMLHttpRequest,g.onreadystatechange=function(){if(4==g.readyState){var a=g.responseText;if(a)try{a=JSON.parse(a)}catch(a){}g.status>=200&&g.status<=299?this.$timeout(function(){e(a)}):(console.error("Request error:",a),this.$timeout(function(){f(a,g.status)}))}}.bind(this),"get"==b&&Object.keys(d).length>0&&(c+=this.formatParams(d)),g.open(b,c,!0),a.next=6,this.setAuthHeadersForRequest(g);case 6:g.setRequestHeader("Content-type","application/json"),"post"==b||"patch"==b?g.send(JSON.stringify(d)):g.send();case 8:case"end":return a.stop()}},a,this)}));return a}()},{key:"formatParams",value:function(a){return"?"+Object.keys(a).map(function(b){return b+"="+encodeURIComponent(a[b])}).join("&")}}]),a}(),p=c.SFMigrationManager=function(){function a(b,c,d){var g=this;f(this,a),this.modelManager=b,this.syncManager=c,this.storageManager=d,this.loadMigrations(),this.syncManager.addEventHandler(function(){var a=e(regeneratorRuntime.mark(function a(b,c){var d,e;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(d="local-data-loaded"==b,e="sync:completed"==b,!d&&!e){a.next=9;break}if(d?g.receivedLocalDataEvent=!0:e&&(g.receivedSyncCompletedEvent=!0),!g.receivedLocalDataEvent||!g.receivedSyncCompletedEvent){a.next=9;break}if(!c||!c.initialSync){a.next=8;break}return a.next=8,g.clearCompletedMigrations();case 8:g.runPendingMigrations();case 9:case"end":return a.stop()}},a,g)}));return function(b,c){return a.apply(this,arguments)}}())}return k(a,[{key:"clearCompletedMigrations",value:function(){function a(){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(){var b;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.getCompletedMigrations();case 2:b=a.sent,b.length=0;case 4:case"end":return a.stop()}},a,this)}));return a}()},{key:"loadMigrations",value:function(){this.migrations=this.registeredMigrations()}},{key:"registeredMigrations",value:function(){}},{key:"runPendingMigrations",value:function(){function a(){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.getPendingMigrations();case 2:for(b=a.sent,c=!0,d=!1,e=void 0,a.prev=6,f=b[Symbol.iterator]();!(c=(g=f.next()).done);c=!0)h=g.value,h.items=[];a.next=14;break;case 10:a.prev=10,a.t0=a.catch(6),d=!0,e=a.t0;case 14:a.prev=14,a.prev=15,!c&&f.return&&f.return();case 17:if(a.prev=17,!d){a.next=20;break}throw e;case 20:return a.finish(17);case 21:return a.finish(14);case 22:i=!0,j=!1,k=void 0,a.prev=25,l=this.modelManager.allItems[Symbol.iterator]();case 27:if(i=(m=l.next()).done){a.next=51;break}for(n=m.value,o=!0,p=!1,q=void 0,a.prev=32,r=b[Symbol.iterator]();!(o=(s=r.next()).done);o=!0)h=s.value,n.content_type==h.content_type&&h.items.push(n);a.next=40;break;case 36:a.prev=36,a.t1=a.catch(32),p=!0,q=a.t1;case 40:a.prev=40,a.prev=41,!o&&r.return&&r.return();case 43:if(a.prev=43,!p){a.next=46;break}throw q;case 46:return a.finish(43);case 47:return a.finish(40);case 48:i=!0,a.next=27;break;case 51:a.next=57;break;case 53:a.prev=53,a.t2=a.catch(25),j=!0,k=a.t2;case 57:a.prev=57,a.prev=58,!i&&l.return&&l.return();case 60:if(a.prev=60,!j){a.next=63;break}throw k;case 63:return a.finish(60);case 64:return a.finish(57);case 65:for(t=!0,u=!1,v=void 0,a.prev=68,w=b[Symbol.iterator]();!(t=(x=w.next()).done);t=!0)h=x.value,h.items&&h.items.length>0?this.runMigration(h,h.items):this.markMigrationCompleted(h);a.next=76;break;case 72:a.prev=72,a.t3=a.catch(68),u=!0,v=a.t3;case 76:a.prev=76,a.prev=77,!t&&w.return&&w.return();case 79:if(a.prev=79,!u){a.next=82;break}throw v;case 82:return a.finish(79);case 83:return a.finish(76);case 84:case"end":return a.stop()}},a,this,[[6,10,14,22],[15,,17,21],[25,53,57,65],[32,36,40,48],[41,,43,47],[58,,60,64],[68,72,76,84],[77,,79,83]])}));return a}()},{key:"encode",value:function(a){return window.btoa(a)}},{key:"decode",value:function(a){return window.atob(a)}},{key:"getCompletedMigrations",value:function(){function a(){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(){var b;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(this._completed){a.next=5;break}return a.next=3,this.storageManager.getItem("migrations");case 3:b=a.sent,this._completed=b?JSON.parse(b):[];case 5:return a.abrupt("return",this._completed);case 6:case"end":return a.stop()}},a,this)}));return a}()},{key:"getPendingMigrations",value:function(){function a(){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(){var b,c=this;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.getCompletedMigrations();case 2:return b=a.sent,a.abrupt("return",this.migrations.filter(function(a){return-1==b.indexOf(c.encode(a.name))}));case 4:case"end":return a.stop()}},a,this)}));return a}()},{key:"markMigrationCompleted",value:function(){function a(a){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(b){var c;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.getCompletedMigrations();case 2:c=a.sent,c.push(this.encode(b.name)),this.storageManager.setItem("migrations",JSON.stringify(c));case 5:case"end":return a.stop()}},a,this)}));return a}()},{key:"runMigration",value:function(){function a(a,c){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(b,c){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:console.log("Running migration:",b.name),b.handler(c),this.markMigrationCompleted(b);case 3:case"end":return a.stop()}},a,this)}));return a}()}]),a}(),q=c.SFModelManager=function(){function a(b){f(this,a),a.MappingSourceRemoteRetrieved="MappingSourceRemoteRetrieved",a.MappingSourceRemoteSaved="MappingSourceRemoteSaved",a.MappingSourceLocalSaved="MappingSourceLocalSaved",a.MappingSourceLocalRetrieved="MappingSourceLocalRetrieved",
a.MappingSourceComponentRetrieved="MappingSourceComponentRetrieved",a.MappingSourceDesktopInstalled="MappingSourceDesktopInstalled",a.MappingSourceRemoteActionRetrieved="MappingSourceRemoteActionRetrieved",a.MappingSourceFileImport="MappingSourceFileImport",a.isMappingSourceRetrieved=function(b){return[a.MappingSourceRemoteRetrieved,a.MappingSourceComponentRetrieved,a.MappingSourceRemoteActionRetrieved].includes(b)},this.$timeout=b||setTimeout.bind(window),this.itemSyncObservers=[],this.itemsPendingRemoval=[],this.items=[],this.itemsHash={},this.missedReferences={}}return k(a,[{key:"handleSignout",value:function(){this.items.length=0,this.itemsHash={},this.itemsPendingRemoval.length=0,this.missedReferences={}}},{key:"alternateUUIDForItem",value:function(){function b(a){return c.apply(this,arguments)}var c=e(regeneratorRuntime.mark(function b(c){var d;return regeneratorRuntime.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return d=this.createItem(c),b.next=3,SFJS.crypto.generateUUID();case 3:return d.uuid=b.sent,d.informReferencesOfUUIDChange(c.uuid,d.uuid),this.informModelsOfUUIDChangeForItem(d,c.uuid,d.uuid),console.log(c.uuid,"--\x3e",d.uuid),c.deleted=!0,c.content.references=[],c.setDirty(!1),this.mapResponseItemsToLocalModels([c],a.MappingSourceLocalSaved),this.addItem(d),d.setDirty(!0),this.resolveReferencesForItem(d),b.abrupt("return",d);case 15:case"end":return b.stop()}},b,this)}));return b}()},{key:"informModelsOfUUIDChangeForItem",value:function(a,b,c){var d=!0,e=!1,f=void 0;try{for(var g,h=this.items[Symbol.iterator]();!(d=(g=h.next()).done);d=!0){g.value.potentialItemOfInterestHasChangedItsUUID(a,b,c)}}catch(a){e=!0,f=a}finally{try{!d&&h.return&&h.return()}finally{if(e)throw f}}}},{key:"didSyncModelsOffline",value:function(b){this.notifySyncObserversOfModels(b,a.MappingSourceLocalSaved)}},{key:"mapResponseItemsToLocalModels",value:function(a,b,c){return this.mapResponseItemsToLocalModelsOmittingFields(a,null,b,c)}},{key:"mapResponseItemsToLocalModelsOmittingFields",value:function(a,b,c,d){var e=[],f=[],g=[],h=!0,j=!1,k=void 0;try{for(var l,m=a[Symbol.iterator]();!(h=(l=m.next()).done);h=!0){var n=l.value;if(n)if(n.content_type&&n.content&&n.uuid||n.deleted||n.errorDecrypting){if(Array.isArray(b)){var o=!0,p=!1,q=void 0;try{for(var r,s=b[Symbol.iterator]();!(o=(r=s.next()).done);o=!0){var t=r.value;delete n[t]}}catch(a){p=!0,q=a}finally{try{!o&&s.return&&s.return()}finally{if(p)throw q}}}var u=this.findItem(n.uuid);if(u&&(u.updateFromJSON(n),u.dummy=!1),this.itemsPendingRemoval.includes(n.uuid))_.pull(this.itemsPendingRemoval,n.uuid);else{var v=n.content_type||u&&u.content_type,w=this.acceptableContentTypes&&!this.acceptableContentTypes.includes(v);if(!w){var x=!1;if(1==n.deleted){if(!n.dirty){u&&(g.push(u),this.removeItemLocally(u));continue}x=!0}u||(u=this.createItem(n,!0)),this.addItem(u,x),u.errorDecrypting||g.push(u),e.push(u),f.push(n)}}}else console.error("Server response item is corrupt:",n)}}catch(a){j=!0,k=a}finally{try{!h&&m.return&&m.return()}finally{if(j)throw k}}var y=!0,z=!1,A=void 0;try{for(var B,C=f.entries()[Symbol.iterator]();!(y=(B=C.next()).done);y=!0){var D=B.value,E=i(D,2),F=E[0],G=E[1],H=e[F];G.content&&this.resolveReferencesForItem(H);var I=this.popMissedReferenceStructsForObject(G),J=!0,K=!1,L=void 0;try{for(var M,N=I[Symbol.iterator]();!(J=(M=N.next()).done);J=!0){var O=M.value;this.resolveReferencesForItem(O.for_item)}}catch(a){K=!0,L=a}finally{try{!J&&N.return&&N.return()}finally{if(K)throw L}}H.didFinishSyncing()}}catch(a){z=!0,A=a}finally{try{!y&&C.return&&C.return()}finally{if(z)throw A}}return this.notifySyncObserversOfModels(g,c,d),e}},{key:"missedReferenceBuildKey",value:function(a,b){return a+":"+b}},{key:"popMissedReferenceStructsForObject",value:function(a){var b=[],c=[],d=!0,e=!1,f=void 0;try{for(var g,h=Object.keys(this.missedReferences)[Symbol.iterator]();!(d=(g=h.next()).done);d=!0){var i=g.value;i.split(":")[0]==a.uuid&&(b.push(this.missedReferences[i]),c.push(i))}}catch(a){e=!0,f=a}finally{try{!d&&h.return&&h.return()}finally{if(e)throw f}}var j=!0,k=!1,l=void 0;try{for(var m,n=c[Symbol.iterator]();!(j=(m=n.next()).done);j=!0){var o=m.value;delete this.missedReferences[o]}}catch(a){k=!0,l=a}finally{try{!j&&n.return&&n.return()}finally{if(k)throw l}}return b}},{key:"resolveReferencesForItem",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],c=a.contentObject;if(a.updateLocalRelationships(),c.references){var d=c.references.slice(),e=d.map(function(a){return a.uuid}),f=this.findItems(e,!0),g=!0,h=!1,j=void 0;try{for(var k,l=f.entries()[Symbol.iterator]();!(g=(k=l.next()).done);g=!0){var m=k.value,n=i(m,2),o=n[0],p=n[1];if(p)a.addItemAsRelationship(p),b&&p.setDirty(!0);else{var q=e[o],r=this.missedReferenceBuildKey(q,a.uuid);if(!this.missedReferences[r]){var s={reference_uuid:q,for_item:a};this.missedReferences[r]=s}}}}catch(a){h=!0,j=a}finally{try{!g&&l.return&&l.return()}finally{if(h)throw j}}}}},{key:"notifySyncObserversOfModels",value:function(a,b,c){var d=this,e=!0,f=!1,g=void 0;try{for(var h,i=this.itemSyncObservers[Symbol.iterator]();!(e=(h=i.next()).done);e=!0){var j,k,l,m=h.value;!function(e){j=e.types.includes("*")?a:a.filter(function(a){return e.types.includes(a.content_type)}),k=[],l=[];var f=!0,g=!1,h=void 0;try{for(var i,m=j[Symbol.iterator]();!(f=(i=m.next()).done);f=!0){var n=i.value;n.deleted?l.push(n):k.push(n)}}catch(a){g=!0,h=a}finally{try{!f&&m.return&&m.return()}finally{if(g)throw h}}j.length>0&&d._callSyncObserverCallbackWithTimeout(e,j,k,l,b,c)}(m)}}catch(a){f=!0,g=a}finally{try{!e&&i.return&&i.return()}finally{if(f)throw g}}}},{key:"_callSyncObserverCallbackWithTimeout",value:function(a,b,c,d,e,f){this.$timeout(function(){a.callback(b,c,d,e,f)})}},{key:"createItem",value:function(b,c){var d=a.ContentTypeClassMapping&&a.ContentTypeClassMapping[b.content_type];d||(d=u);var e=new d(b);return c||this.notifySyncObserversOfModels([e],a.MappingSourceLocalSaved),e}},{key:"createDuplicateItem",value:function(a){return this.createItem(a,!0)}},{key:"addDuplicatedItem",value:function(a,b){this.addItem(a);var c=!0,d=!1,e=void 0;try{for(var f,g=b.referencingObjects[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){var h=f.value;h.addItemAsRelationship(a),h.setDirty(!0)}}catch(a){d=!0,e=a}finally{try{!c&&g.return&&g.return()}finally{if(d)throw e}}this.resolveReferencesForItem(a),a.conflict_of=b.uuid,a.setDirty(!0)}},{key:"addItem",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.addItems([a],b)}},{key:"addItems",value:function(a){var b=this;arguments.length>1&&void 0!==arguments[1]&&arguments[1];a.forEach(function(a){b.itemsHash[a.uuid]||(b.itemsHash[a.uuid]=a,b.items.push(a))})}},{key:"addItemSyncObserver",value:function(a,b,c){Array.isArray(b)||(b=[b]),this.itemSyncObservers.push({id:a,types:b,callback:c})}},{key:"removeItemSyncObserver",value:function(a){_.remove(this.itemSyncObservers,_.find(this.itemSyncObservers,{id:a}))}},{key:"getDirtyItems",value:function(){return this.items.filter(function(a){return 1==a.dirty&&!a.dummy&&(!a.errorDecrypting||a.deleted)})}},{key:"clearDirtyItems",value:function(a){var b=!0,c=!1,d=void 0;try{for(var e,f=a[Symbol.iterator]();!(b=(e=f.next()).done);b=!0){e.value.setDirty(!1)}}catch(a){c=!0,d=a}finally{try{!b&&f.return&&f.return()}finally{if(c)throw d}}}},{key:"setItemToBeDeleted",value:function(a){a.deleted=!0,a.dummy||a.setDirty(!0),this.removeAndDirtyAllRelationshipsForItem(a)}},{key:"removeAndDirtyAllRelationshipsForItem",value:function(a){var b=!0,c=!1,d=void 0;try{for(var e,f=a.content.references[Symbol.iterator]();!(b=(e=f.next()).done);b=!0){var g=e.value,h=this.findItem(g.uuid);h&&(a.removeItemAsRelationship(h),h.hasRelationshipWithItem(a)&&(h.removeItemAsRelationship(a),h.setDirty(!0)))}}catch(a){c=!0,d=a}finally{try{!b&&f.return&&f.return()}finally{if(c)throw d}}var i=!0,j=!1,k=void 0;try{for(var l,m=a.referencingObjects[Symbol.iterator]();!(i=(l=m.next()).done);i=!0){var n=l.value;n.removeItemAsRelationship(a),n.setDirty(!0)}}catch(a){j=!0,k=a}finally{try{!i&&m.return&&m.return()}finally{if(j)throw k}}a.referencingObjects=[]}},{key:"setAllItemsDirty",value:function(){var a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],b=this.allItems,c=!0,d=!1,e=void 0;try{for(var f,g=b[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){f.value.setDirty(!0,a)}}catch(a){d=!0,e=a}finally{try{!c&&g.return&&g.return()}finally{if(d)throw e}}}},{key:"removeItemLocally",value:function(a,b){_.remove(this.items,{uuid:a.uuid}),delete this.itemsHash[a.uuid],a.isBeingRemovedLocally(),this.itemsPendingRemoval.push(a.uuid)}},{key:"allItemsMatchingTypes",value:function(a){return this.allItems.filter(function(b){return(_.includes(a,b.content_type)||_.includes(a,"*"))&&!b.dummy})}},{key:"invalidItems",value:function(){return this.allItems.filter(function(a){return a.errorDecrypting})}},{key:"validItemsForContentType",value:function(a){return this.allItems.filter(function(b){return b.content_type==a&&!b.errorDecrypting})}},{key:"findItem",value:function(a){return this.itemsHash[a]}},{key:"findItems",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done);d=!0){var i=g.value,j=this.itemsHash[i];(j||b)&&c.push(j)}}catch(a){e=!0,f=a}finally{try{!d&&h.return&&h.return()}finally{if(e)throw f}}return c}},{key:"itemsMatchingPredicate",value:function(a){return this.itemsMatchingPredicates([a])}},{key:"itemsMatchingPredicates",value:function(a){return this.filterItemsWithPredicates(this.allItems,a)}},{key:"filterItemsWithPredicates",value:function(a,b){return a.filter(function(a){var c=!0,d=!1,e=void 0;try{for(var f,g=b[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){var h=f.value;if(!a.satisfiesPredicate(h))return!1}}catch(a){d=!0,e=a}finally{try{!c&&g.return&&g.return()}finally{if(d)throw e}}return!0})}},{key:"importItems",value:function(b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=b[Symbol.iterator]();!(d=(g=h.next()).done);d=!0){var i=g.value,j=this.findItem(i.uuid);if(j&&!j.errorDecrypting){i.uuid=null;var k=this.createDuplicateItem(i);i.deleted||j.isItemContentEqualWith(k)||(this.addDuplicatedItem(k,j),c.push(k))}else c.push(i),j&&j.errorDecrypting&&(j.errorDecrypting=!1)}}catch(a){e=!0,f=a}finally{try{!d&&h.return&&h.return()}finally{if(e)throw f}}var l=this.mapResponseItemsToLocalModels(c,a.MappingSourceFileImport),m=!0,n=!1,o=void 0;try{for(var p,q=l[Symbol.iterator]();!(m=(p=q.next()).done);m=!0){var r=p.value;r.setDirty(!0,!0),r.deleted=!1}}catch(a){n=!0,o=a}finally{try{!m&&q.return&&q.return()}finally{if(n)throw o}}return l}},{key:"getAllItemsJSONData",value:function(){function a(a,c,d){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(b,c,d){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Promise.all(this.allItems.map(function(a){return new v(a,b,c).paramsForExportFile()})).then(function(a){if(d&&0==a.length)return null;var e={items:a};return b&&(e.auth_params=c),JSON.stringify(e,null,2)}));case 1:case"end":return a.stop()}},a,this)}));return a}()},{key:"allItems",get:function(){return this.items.filter(function(a){return!a.dummy})}}]),a}(),r=c.SFSessionHistoryManager=function(){function a(b,c,d,e,g){var h=this;f(this,a),this.modelManager=b,this.storageManager=c,this.$timeout=g||setTimeout.bind(window),this.keyRequestHandler=d,this.loadFromDisk().then(function(){h.modelManager.addItemSyncObserver("session-history",e,function(a,b,c,d,e){var f=!0,g=!1,i=void 0;try{for(var j,k=a[Symbol.iterator]();!(f=(j=k.next()).done);f=!0){var l=j.value;try{h.addHistoryEntryForItem(l)}catch(a){console.log("Caught exception while trying to add item history entry",a)}}}catch(a){g=!0,i=a}finally{try{!f&&k.return&&k.return()}finally{if(g)throw i}}})})}return k(a,[{key:"encryptionParams",value:function(){function a(){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",this.keyRequestHandler());case 1:case"end":return a.stop()}},a,this)}));return a}()},{key:"addHistoryEntryForItem",value:function(a){var b=this,c={uuid:a.uuid,content_type:a.content_type,updated_at:a.updated_at,content:a.content},d=this.historySession.addEntryForItem(c);this.autoOptimize&&this.historySession.optimizeHistoryForItem(a),d&&this.diskEnabled&&(this.diskTimeout&&(this.$timeout.hasOwnProperty("cancel")?this.$timeout.cancel(this.diskTimeout):clearTimeout(this.diskTimeout)),this.diskTimeout=this.$timeout(function(){b.saveToDisk()},2e3))}},{key:"historyForItem",value:function(a){return this.historySession.historyForItem(a)}},{key:"clearHistoryForItem",value:function(){function a(a){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(b){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return this.historySession.clearItemHistory(b),a.abrupt("return",this.saveToDisk());case 2:case"end":return a.stop()}},a,this)}));return a}()},{key:"clearAllHistory",value:function(){function a(){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return this.historySession.clearAllHistory(),a.abrupt("return",this.storageManager.removeItem("sessionHistory_revisions"));case 2:case"end":return a.stop()}},a,this)}));return a}()},{key:"toggleDiskSaving",value:function(){function a(){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(this.diskEnabled=!this.diskEnabled,!this.diskEnabled){a.next=6;break}this.storageManager.setItem("sessionHistory_persist",JSON.stringify(!0)),this.saveToDisk(),a.next=8;break;case 6:return this.storageManager.setItem("sessionHistory_persist",JSON.stringify(!1)),a.abrupt("return",this.storageManager.removeItem("sessionHistory_revisions"));case 8:case"end":return a.stop()}},a,this)}));return a}()},{key:"saveToDisk",value:function(){function a(){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(){var b,c,d=this;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(this.diskEnabled){a.next=2;break}return a.abrupt("return");case 2:return a.next=4,this.encryptionParams();case 4:b=a.sent,c=new v(this.historySession,b.keys,b.auth_params),c.paramsForSync().then(function(a){d.storageManager.setItem("sessionHistory_revisions",JSON.stringify(a))});case 7:case"end":return a.stop()}},a,this)}));return a}()},{key:"loadFromDisk",value:function(){function a(){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(){var b,c,d,e,f;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.storageManager.getItem("sessionHistory_persist");case 2:return b=a.sent,b&&(this.diskEnabled=JSON.parse(b)),a.next=6,this.storageManager.getItem("sessionHistory_revisions");case 6:if(!(c=a.sent)){a.next=18;break}return c=JSON.parse(c),a.next=11,this.encryptionParams();case 11:return d=a.sent,a.next=14,SFJS.itemTransformer.decryptItem(c,d.keys);case 14:e=new x(c),this.historySession=e,a.next=19;break;case 18:this.historySession=new x;case 19:return a.next=21,this.storageManager.getItem("sessionHistory_autoOptimize");case 21:f=a.sent,this.autoOptimize=!f||JSON.parse(f);case 23:case"end":return a.stop()}},a,this)}));return a}()},{key:"toggleAutoOptimize",value:function(){function a(){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:this.autoOptimize=!this.autoOptimize,this.autoOptimize?this.storageManager.setItem("sessionHistory_autoOptimize",JSON.stringify(!0)):this.storageManager.setItem("sessionHistory_autoOptimize",JSON.stringify(!1));case 2:case"end":return a.stop()}},a,this)}));return a}()}]),a}(),s=c.SFStorageManager=function(){function a(){f(this,a)}return k(a,[{key:"setItem",value:function(){function a(a,c){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(b,c){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:case"end":return a.stop()}},a,this)}));return a}()},{key:"getItem",value:function(){function a(a){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(b){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:case"end":return a.stop()}},a,this)}));return a}()},{key:"removeItem",value:function(){function a(a){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(b){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:case"end":return a.stop()}},a,this)}));return a}()},{key:"clear",value:function(){function a(){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:case"end":return a.stop()}},a,this)}));return a}()},{key:"getAllModels",value:function(){function a(){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:case"end":return a.stop()}},a,this)}));return a}()},{key:"saveModel",value:function(){function a(a){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(b){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",this.saveModels([b]));case 1:case"end":return a.stop()}},a,this)}));return a}()},{key:"saveModels",value:function(){function a(a){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(b){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:case"end":return a.stop()}},a,this)}));return a}()},{key:"deleteModel",value:function(){function a(a){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(b){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:case"end":return a.stop()}},a,this)}));return a}()},{key:"clearAllModels",value:function(){function a(){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:case"end":return a.stop()}},a,this)}));return a}()},{key:"clearAllData",value:function(){function a(){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",Promise.all([this.clear(),this.clearAllModels()]));case 1:case"end":return a.stop()}},a,this)}));return a}()}]),a}(),t=c.SFSyncManager=function(){function a(b,c,d,e,g){f(this,a),a.KeyRequestLoadLocal="KeyRequestLoadLocal",a.KeyRequestSaveLocal="KeyRequestSaveLocal",a.KeyRequestLoadSaveAccount="KeyRequestLoadSaveAccount",this.httpManager=d,this.modelManager=b,this.storageManager=c,this.$interval=g||setInterval.bind(window),this.$timeout=e||setTimeout.bind(window),this.syncStatus={},this.syncStatusObservers=[],this.eventHandlers=[]}return k(a,[{key:"getServerURL",value:function(){function a(){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.storageManager.getItem("server");case 2:if(a.t0=a.sent,a.t0){a.next=5;break}a.t0=window._default_sf_server;case 5:return a.abrupt("return",a.t0);case 6:case"end":return a.stop()}},a,this)}));return a}()},{key:"getSyncURL",value:function(){function a(){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.getServerURL();case 2:return a.t0=a.sent,a.abrupt("return",a.t0+"/items/sync");case 4:case"end":return a.stop()}},a,this)}));return a}()},{key:"registerSyncStatusObserver",value:function(a){var b={key:new Date,callback:a};return this.syncStatusObservers.push(b),b}},{key:"removeSyncStatusObserver",value:function(a){_.pull(this.syncStatusObservers,a)}},{key:"syncStatusDidChange",value:function(){var a=this;this.syncStatusObservers.forEach(function(b){b.callback(a.syncStatus)})}},{key:"addEventHandler",value:function(a){return this.eventHandlers.push(a),a}},{key:"removeEventHandler",value:function(a){_.pull(this.eventHandlers,a)}},{key:"notifyEvent",value:function(a,b){var c=!0,d=!1,e=void 0;try{for(var f,g=this.eventHandlers[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){(0,f.value)(a,b||{})}}catch(a){d=!0,e=a}finally{try{!c&&g.return&&g.return()}finally{if(d)throw e}}}},{key:"setKeyRequestHandler",value:function(a){this.keyRequestHandler=a}},{key:"getActiveKeyInfo",value:function(){function a(a){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(b){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",this.keyRequestHandler(b));case 1:case"end":return a.stop()}},a,this)}));return a}()},{key:"initialDataLoaded",value:function(){return this._initialDataLoaded}},{key:"loadLocalItems",value:function(){function b(a){return c.apply(this,arguments)}var c=e(regeneratorRuntime.mark(function b(c){var d=this,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;return regeneratorRuntime.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.abrupt("return",this.storageManager.getAllModels().then(function(b){var g=b.length,h=0,i=[],j=function(){var k=e(regeneratorRuntime.mark(function e(){var k,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return k=b.slice(h,h+f),e.next=3,d.handleItemsResponse(k,null,q.MappingSourceLocalRetrieved,a.KeyRequestLoadLocal);case 3:if(l=e.sent,i.push(l),!((h+=k.length)<g)){e.next=10;break}return e.abrupt("return",new Promise(function(a,b){d.$timeout(function(){c&&c(h,g),j().then(a)})}));case 10:d.notifyEvent("local-data-loaded"),d._initialDataLoaded=!0;case 12:case"end":return e.stop()}},e,d)}));return function(){return k.apply(this,arguments)}}();return j()}));case 1:case"end":return b.stop()}},b,this)}));return b}()},{key:"writeItemsToLocalStorage",value:function(){function b(a,b){return c.apply(this,arguments)}var c=e(regeneratorRuntime.mark(function b(c,d){var f=this;return regeneratorRuntime.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.abrupt("return",new Promise(function(){var b=e(regeneratorRuntime.mark(function b(g,h){var i;return regeneratorRuntime.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(0!=c.length){b.next=3;break}return g(),b.abrupt("return");case 3:return b.next=5,f.getActiveKeyInfo(a.KeyRequestSaveLocal);case 5:i=b.sent,Promise.all(c.map(function(){var a=e(regeneratorRuntime.mark(function a(b){var c;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return c=new v(b,i.keys,i.auth_params),a.next=3,c.paramsForLocalStorage();case 3:return c=a.sent,d&&delete c.dirty,a.abrupt("return",c);case 6:case"end":return a.stop()}},a,f)}));return function(b){return a.apply(this,arguments)}}())).then(function(a){f.storageManager.saveModels(a).then(function(){f.syncStatus.localError&&(f.syncStatus.localError=null,f.syncStatusDidChange()),g()}).catch(function(a){console.error("Error writing items",a),f.syncStatus.localError=a,f.syncStatusDidChange(),h()})}).catch(function(a){h(a)});case 7:case"end":return b.stop()}},b,f)}));return function(a,c){return b.apply(this,arguments)}}()));case 1:case"end":return b.stop()}},b,this)}));return b}()},{key:"syncOffline",value:function(){function a(a){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(b){var c,d,e,f,g,h,i=this;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:for(c=!0,d=!1,e=void 0,a.prev=3,f=b[Symbol.iterator]();!(c=(g=f.next()).done);c=!0)h=g.value,h.updated_at=new Date;a.next=11;break;case 7:a.prev=7,a.t0=a.catch(3),d=!0,e=a.t0;case 11:a.prev=11,a.prev=12,!c&&f.return&&f.return();case 14:if(a.prev=14,!d){a.next=17;break}throw e;case 17:return a.finish(14);case 18:return a.finish(11);case 19:return a.abrupt("return",this.writeItemsToLocalStorage(b,!0).then(function(a){var c=!0,d=!1,e=void 0;try{for(var f,g=b[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){var h=f.value;h.deleted&&i.modelManager.removeItemLocally(h)}}catch(a){d=!0,e=a}finally{try{!c&&g.return&&g.return()}finally{if(d)throw e}}return i.notifyEvent("sync:completed"),i.modelManager.didSyncModelsOffline(b),{saved_items:b}}));case 20:case"end":return a.stop()}},a,this,[[3,7,11,19],[12,,14,18]])}));return a}()},{key:"markAllItemsDirtyAndSaveOffline",value:function(){function a(a){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(b){var c,d,e,f,g,h,i,j,k,l,m,n,o;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(c=this.modelManager.allItems.filter(function(a){return!a.errorDecrypting}).slice(),!b){a.next=28;break}d=!0,e=!1,f=void 0,a.prev=5,g=c[Symbol.iterator]();case 7:if(d=(h=g.next()).done){a.next=14;break}return i=h.value,a.next=11,this.modelManager.alternateUUIDForItem(i);case 11:d=!0,a.next=7;break;case 14:a.next=20;break;case 16:a.prev=16,a.t0=a.catch(5),e=!0,f=a.t0;case 20:a.prev=20,a.prev=21,!d&&g.return&&g.return();case 23:if(a.prev=23,!e){a.next=26;break}throw f;case 26:return a.finish(23);case 27:return a.finish(20);case 28:for(j=this.modelManager.allItems,k=!0,l=!1,m=void 0,a.prev=32,n=j[Symbol.iterator]();!(k=(o=n.next()).done);k=!0)i=o.value,i.setDirty(!0);a.next=40;break;case 36:a.prev=36,a.t1=a.catch(32),l=!0,m=a.t1;case 40:a.prev=40,a.prev=41,!k&&n.return&&n.return();case 43:if(a.prev=43,!l){a.next=46;break}throw m;case 46:return a.finish(43);case 47:return a.finish(40);case 48:return a.abrupt("return",this.writeItemsToLocalStorage(j,!1));case 49:case"end":return a.stop()}},a,this,[[5,16,20,28],[21,,23,27],[32,36,40,48],[41,,43,47]])}));return a}()},{key:"setSyncToken",value:function(){function a(a){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(b){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return this._syncToken=b,a.next=3,this.storageManager.setItem("syncToken",b);case 3:case"end":return a.stop()}},a,this)}));return a}()},{key:"getSyncToken",value:function(){function a(){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(this._syncToken){a.next=4;break}return a.next=3,this.storageManager.getItem("syncToken");case 3:this._syncToken=a.sent;case 4:return a.abrupt("return",this._syncToken);case 5:case"end":return a.stop()}},a,this)}));return a}()},{key:"setCursorToken",value:function(){function a(a){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(b){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(this._cursorToken=b,!b){a.next=6;break}return a.next=4,this.storageManager.setItem("cursorToken",b);case 4:a.next=8;break;case 6:return a.next=8,this.storageManager.removeItem("cursorToken");case 8:case"end":return a.stop()}},a,this)}));return a}()},{key:"getCursorToken",value:function(){function a(){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(this._cursorToken){a.next=4;break}return a.next=3,this.storageManager.getItem("cursorToken");case 3:this._cursorToken=a.sent;case 4:return a.abrupt("return",this._cursorToken);case 5:case"end":return a.stop()}},a,this)}));return a}()},{key:"clearQueuedCallbacks",value:function(){this._queuedCallbacks=[]}},{key:"callQueuedCallbacks",value:function(a){var b=this.queuedCallbacks;if(b.length){var c=!0,d=!1,e=void 0;try{for(var f,g=b[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){(0,f.value)(a)}}catch(a){d=!0,e=a}finally{try{!c&&g.return&&g.return()}finally{if(d)throw e}}this.clearQueuedCallbacks()}}},{key:"beginCheckingIfSyncIsTakingTooLong",value:function(){this.syncStatus.checker&&this.stopCheckingIfSyncIsTakingTooLong(),this.syncStatus.checker=this.$interval(function(){(new Date-this.syncStatus.syncStart)/1e3>5&&(this.notifyEvent("sync:taking-too-long"),this.stopCheckingIfSyncIsTakingTooLong())}.bind(this),500)}},{key:"stopCheckingIfSyncIsTakingTooLong",value:function(){this.$interval.hasOwnProperty("cancel")?this.$interval.cancel(this.syncStatus.checker):clearInterval(this.syncStatus.checker),this.syncStatus.checker=null}},{key:"lockSyncing",value:function(){this.syncLocked=!0}},{key:"unlockSyncing",value:function(){this.syncLocked=!1}},{key:"sync",value:function(){function b(){return c.apply(this,arguments)}var c=e(regeneratorRuntime.mark(function b(){var c=this,d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return regeneratorRuntime.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.abrupt("return",new Promise(function(){var b=e(regeneratorRuntime.mark(function b(e,f){var g,h,i,j,k,l,m,n,o,p,q,r;return regeneratorRuntime.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(!c.syncLocked){b.next=4;break}return console.log("Sync Locked, Returning;"),e(),b.abrupt("return");case 4:if(d||(d={}),g=c.modelManager.getDirtyItems(),!c.syncStatus.syncOpInProgress||d.force){b.next=12;break}return c.repeatOnCompletion=!0,c.queuedCallbacks.push(e),c.writeItemsToLocalStorage(g,!1),console.log("Sync op in progress; returning."),b.abrupt("return");case 12:return b.next=14,c.getActiveKeyInfo(a.KeyRequestLoadSaveAccount);case 14:if(h=b.sent,!h.offline){b.next=18;break}return c.syncOffline(g).then(function(a){c.modelManager.clearDirtyItems(g),e(a)}).catch(function(a){c.notifyEvent("sync-exception",a)}),b.abrupt("return");case 18:return i=c.syncStatus.needsMoreSync,c.syncStatus.syncOpInProgress=!0,c.syncStatus.syncStart=new Date,c.beginCheckingIfSyncIsTakingTooLong(),j=100,k=g.slice(0,j),k.length<g.length?c.syncStatus.needsMoreSync=!0:c.syncStatus.needsMoreSync=!1,i||(c.syncStatus.total=g.length,c.syncStatus.current=0),c.syncStatus.current>c.syncStatus.total&&(c.syncStatus.total=c.syncStatus.current),c.syncStatusDidChange(),c.allRetreivedItems||(c.allRetreivedItems=[]),c.allSavedItems||(c.allSavedItems=[]),l={},l.limit=150,b.prev=32,b.next=35,Promise.all(k.map(function(a){var b=new v(a,h.keys,h.auth_params);return b.additionalFields=d.additionalFields,b.paramsForSync()})).then(function(a){l.items=a});case 35:b.next=40;break;case 37:b.prev=37,b.t0=b.catch(32),c.notifyEvent("sync-exception",b.t0);case 40:for(m=!0,n=!1,o=void 0,b.prev=43,p=k[Symbol.iterator]();!(m=(q=p.next()).done);m=!0)r=q.value,r.dirtyCount=0;b.next=51;break;case 47:b.prev=47,b.t1=b.catch(43),n=!0,o=b.t1;case 51:b.prev=51,b.prev=52,!m&&p.return&&p.return();case 54:if(b.prev=54,!n){b.next=57;break}throw o;case 57:return b.finish(54);case 58:return b.finish(51);case 59:return b.next=61,c.getSyncToken();case 61:return l.sync_token=b.sent,b.next=64,c.getCursorToken();case 64:return l.cursor_token=b.sent,b.prev=65,b.t2=c.httpManager,b.next=69,c.getSyncURL();case 69:b.t3=b.sent,b.t4=l,b.t5=function(a){try{c.handleSyncSuccess(k,a,d).then(function(){e(a)})}catch(a){console.log("Caught sync success exception:",a)}},b.t6=function(a,b){c.handleSyncError(a,b,g).then(function(a){e(a)})},b.t2.postAbsolute.call(b.t2,b.t3,b.t4,b.t5,b.t6),b.next=79;break;case 76:b.prev=76,b.t7=b.catch(65),console.log("Sync exception caught:",b.t7);case 79:case"end":return b.stop()}},b,c,[[32,37],[43,47,51,59],[52,,54,58],[65,76]])}));return function(a,c){return b.apply(this,arguments)}}()));case 1:case"end":return b.stop()}},b,this)}));return b}()},{key:"handleSyncSuccess",value:function(){function b(a,b,d){return c.apply(this,arguments)}var c=e(regeneratorRuntime.mark(function b(c,d,e){
var f,g,h,i,j,k,l,m,n,o,p,r,s,t,u=this;return regeneratorRuntime.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:for(f=[],g=!0,h=!1,i=void 0,b.prev=4,j=c[Symbol.iterator]();!(g=(k=j.next()).done);g=!0)l=k.value,0==l.dirtyCount&&f.push(l);b.next=12;break;case 8:b.prev=8,b.t0=b.catch(4),h=!0,i=b.t0;case 12:b.prev=12,b.prev=13,!g&&j.return&&j.return();case 15:if(b.prev=15,!h){b.next=18;break}throw i;case 18:return b.finish(15);case 19:return b.finish(12);case 20:return this.modelManager.clearDirtyItems(f),this.syncStatus.error=null,m=this.allSavedItems.map(function(a){return a.uuid}),d.retrieved_items=d.retrieved_items.filter(function(a){return!m.includes(a.uuid)}),b.next=26,this.handleItemsResponse(d.retrieved_items,null,q.MappingSourceRemoteRetrieved,a.KeyRequestLoadSaveAccount);case 26:return n=b.sent,this.allRetreivedItems=this.allRetreivedItems.concat(n),this.syncStatus.retrievedCount=this.allRetreivedItems.length,o=["content","auth_hash"],b.next=32,this.handleItemsResponse(d.saved_items,o,q.MappingSourceRemoteSaved,a.KeyRequestLoadSaveAccount);case 32:return p=b.sent,this.allSavedItems=this.allSavedItems.concat(p),r=d.unsaved,this.handleUnsavedItemsResponse(r),b.next=38,this.writeItemsToLocalStorage(p,!1);case 38:return this.syncStatus.syncOpInProgress=!1,this.syncStatus.current+=c.length,this.syncStatusDidChange(),b.next=43,this.getSyncToken();case 43:return b.t1=b.sent,s=null==b.t1,this.setSyncToken(d.sync_token),this.setCursorToken(d.cursor_token),this.stopCheckingIfSyncIsTakingTooLong(),b.next=50,this.getCursorToken();case 50:if(b.t2=b.sent,b.t2){b.next=53;break}b.t2=this.syncStatus.needsMoreSync;case 53:if(!b.t2){b.next=57;break}return b.abrupt("return",new Promise(function(a,b){setTimeout(function(){this.sync(e).then(a)}.bind(u),10)}));case 57:if(!this.repeatOnCompletion){b.next=62;break}return this.repeatOnCompletion=!1,b.abrupt("return",new Promise(function(a,b){setTimeout(function(){this.sync(e).then(a)}.bind(u),10)}));case 62:return b.next=64,this.writeItemsToLocalStorage(this.allRetreivedItems,!1);case 64:return this.syncStatus.retrievedCount=0,this.syncStatusDidChange(),t=10,(this.allRetreivedItems.length>=t||p.length>=t||r.length>=t)&&this.notifyEvent("major-data-change"),this.callQueuedCallbacks(d),this.notifyEvent("sync:completed",{retrievedItems:this.allRetreivedItems,savedItems:this.allSavedItems,unsavedItems:r,initialSync:s}),this.allRetreivedItems=[],this.allSavedItems=[],b.abrupt("return",d);case 73:case"end":return b.stop()}},b,this,[[4,8,12,20],[13,,15,19]])}));return b}()},{key:"handleSyncError",value:function(){function a(a,c,d){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(b,c,d){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return console.log("Sync error",b),401==c&&this.notifyEvent("sync-session-invalid"),console.log("Sync error: ",b),b||(b={error:{message:"Could not connect to server."}}),this.syncStatus.syncOpInProgress=!1,this.syncStatus.error=b.error,this.syncStatusDidChange(),this.writeItemsToLocalStorage(d,!1),this.modelManager.didSyncModelsOffline(d),this.stopCheckingIfSyncIsTakingTooLong(),this.notifyEvent("sync:error",b.error),this.callQueuedCallbacks({error:"Sync error"}),a.abrupt("return",b);case 13:case"end":return a.stop()}},a,this)}));return a}()},{key:"handleItemsResponse",value:function(){function a(a,c,d,e){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(b,c,d,e){var f,g,h;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.getActiveKeyInfo(e);case 2:return f=a.sent.keys,a.next=5,SFJS.itemTransformer.decryptMultipleItems(b,f);case 5:return g=this.modelManager.mapResponseItemsToLocalModelsOmittingFields(b,c,d),h=g.filter(function(a){var b=a.errorDecryptingValueChanged;return a.errorDecryptingValueChanged=!1,b}),h.length>0&&this.writeItemsToLocalStorage(h,!1),a.abrupt("return",g);case 9:case"end":return a.stop()}},a,this)}));return a}()},{key:"refreshErroredItems",value:function(){function b(){return c.apply(this,arguments)}var c=e(regeneratorRuntime.mark(function b(){var c;return regeneratorRuntime.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(c=this.modelManager.allItems.filter(function(a){return 1==a.errorDecrypting}),!(c.length>0)){b.next=3;break}return b.abrupt("return",this.handleItemsResponse(c,null,q.MappingSourceLocalRetrieved,a.KeyRequestLoadSaveAccount));case 3:case"end":return b.stop()}},b,this)}));return b}()},{key:"handleUnsavedItemsResponse",value:function(){function b(a){return c.apply(this,arguments)}var c=e(regeneratorRuntime.mark(function b(c){var d,e,f,g,h,i,j,k,l,m;return regeneratorRuntime.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(0!=c.length){b.next=2;break}return b.abrupt("return");case 2:console.log("Handle Conflicted Items:",c),d=!0,e=!1,f=void 0,b.prev=6,g=c[Symbol.iterator]();case 8:if(d=(h=g.next()).done){b.next=36;break}return i=h.value,j=i.item,b.t0=SFJS.itemTransformer,b.t1=[j],b.next=15,this.getActiveKeyInfo(a.KeyRequestLoadSaveAccount);case 15:return b.t2=b.sent.keys,b.next=18,b.t0.decryptMultipleItems.call(b.t0,b.t1,b.t2);case 18:if(k=this.modelManager.findItem(j.uuid)){b.next=21;break}return b.abrupt("continue",33);case 21:if(l=i.error,"uuid_conflict"!==l.tag){b.next=27;break}return b.next=25,this.modelManager.alternateUUIDForItem(k);case 25:b.next=33;break;case 27:if("sync_conflict"!==l.tag){b.next=33;break}return b.next=30,SFJS.crypto.generateUUID();case 30:j.uuid=b.sent,m=this.modelManager.createDuplicateItem(j),j.deleted||k.isItemContentEqualWith(m)||this.modelManager.addDuplicatedItem(m,k);case 33:d=!0,b.next=8;break;case 36:b.next=42;break;case 38:b.prev=38,b.t3=b.catch(6),e=!0,f=b.t3;case 42:b.prev=42,b.prev=43,!d&&g.return&&g.return();case 45:if(b.prev=45,!e){b.next=48;break}throw f;case 48:return b.finish(45);case 49:return b.finish(42);case 50:this.sync(null,{additionalFields:["created_at","updated_at"]});case 51:case"end":return b.stop()}},b,this,[[6,38,42,50],[43,,45,49]])}));return b}()},{key:"handleSignout",value:function(){function a(){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:this._syncToken=null,this._cursorToken=null,this._queuedCallbacks=[],this.syncStatus={};case 4:case"end":return a.stop()}},a,this)}));return a}()},{key:"clearSyncToken",value:function(){function a(){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return this._syncToken=null,this._cursorToken=null,a.abrupt("return",this.storageManager.removeItem("syncToken"));case 3:case"end":return a.stop()}},a,this)}));return a}()},{key:"queuedCallbacks",get:function(){return this._queuedCallbacks||(this._queuedCallbacks=[]),this._queuedCallbacks}}]),a}(),u=c.SFItem=function(){function a(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};f(this,a),this.appData={},this.content={},this.referencingObjects=[],this.updateFromJSON(b),this.uuid||"undefined"!=typeof SFJS&&SFJS.crypto.generateUUIDSync&&(this.uuid=SFJS.crypto.generateUUIDSync()),this.content.references||(this.content.references=[])}return k(a,[{key:"updateFromJSON",value:function(b){this.created_at=b.created_at,this.updated_at=b.updated_at,this.deleted=b.deleted,this.uuid=b.uuid,this.enc_item_key=b.enc_item_key,this.auth_hash=b.auth_hash,this.auth_params=b.auth_params;var c=["errorDecrypting","conflict_of","dirty","dirtyCount"],d=!0,e=!1,f=void 0;try{for(var g,h=c[Symbol.iterator]();!(d=(g=h.next()).done);d=!0){var i=g.value;void 0!==b[i]&&(this[i]=b[i])}}catch(a){e=!0,f=a}finally{try{!d&&h.return&&h.return()}finally{if(e)throw f}}this.content_type||(this.content_type=b.content_type);try{var j="string"==typeof b.content?JSON.parse(b.content):b.content;a.deepMerge(this.contentObject,j)}catch(a){console.log("Error while updating item from json",a)}this.created_at?(this.created_at=new Date(this.created_at),this.updated_at=new Date(this.updated_at)):(this.created_at=new Date,this.updated_at=new Date),this._client_updated_at=null,b.content?this.mapContentToLocalProperties(this.contentObject):1==b.deleted&&this.handleDeletedContent()}},{key:"mapContentToLocalProperties",value:function(a){a.appData&&(this.appData=a.appData),this.appData||(this.appData={})}},{key:"createContentJSONFromProperties",value:function(){return this.structureParams()}},{key:"structureParams",value:function(){var a=this.contentObject;return a.appData=this.appData,a}},{key:"handleDeletedContent",value:function(){}},{key:"setDirty",value:function(a,b){this.dirty=a,this.dirtyCount||(this.dirtyCount=0),a?this.dirtyCount++:this.dirtyCount=0,a&&!b?this.client_updated_at=new Date:this.hasRawClientUpdatedAtValue()||(this.client_updated_at=new Date(this.updated_at))}},{key:"updateLocalRelationships",value:function(){}},{key:"addItemAsRelationship",value:function(a){if(a.setIsBeingReferencedBy(this),!this.hasRelationshipWithItem(a)){var b=this.content.references||[];b.push({uuid:a.uuid,content_type:a.content_type}),this.content.references=b}}},{key:"removeItemAsRelationship",value:function(a){a.setIsNoLongerBeingReferencedBy(this),this.removeReferenceWithUuid(a.uuid)}},{key:"setIsBeingReferencedBy",value:function(a){_.find(this.referencingObjects,{uuid:a.uuid})||this.referencingObjects.push(a)}},{key:"setIsNoLongerBeingReferencedBy",value:function(a){_.remove(this.referencingObjects,{uuid:a.uuid}),this.hasRelationshipWithItem(a)&&(this.removeReferenceWithUuid(a.uuid),this.setDirty(!0))}},{key:"removeReferenceWithUuid",value:function(a){var b=this.content.references||[];b=b.filter(function(b){return b.uuid!=a}),this.content.references=b}},{key:"hasRelationshipWithItem",value:function(a){return null!=this.content.references.find(function(b){return b.uuid==a.uuid})}},{key:"isBeingRemovedLocally",value:function(){}},{key:"didFinishSyncing",value:function(){}},{key:"informReferencesOfUUIDChange",value:function(a,b){}},{key:"potentialItemOfInterestHasChangedItsUUID",value:function(a,b,c){var d=!0,e=!1,f=void 0;try{for(var g,h=this.content.references[Symbol.iterator]();!(d=(g=h.next()).done);d=!0){var i=g.value;i.uuid==b&&(i.uuid=c,this.setDirty(!0))}}catch(a){e=!0,f=a}finally{try{!d&&h.return&&h.return()}finally{if(e)throw f}}}},{key:"doNotEncrypt",value:function(){return!1}},{key:"setDomainDataItem",value:function(a,b,c){if(!c)return void console.error("SFItem.AppDomain needs to be set.");var d=this.appData[c];d||(d={}),d[a]=b,this.appData[c]=d}},{key:"getDomainDataItem",value:function(a,b){if(!b)return void console.error("SFItem.AppDomain needs to be set.");var c=this.appData[b];return c?c[a]:null}},{key:"setAppDataItem",value:function(b,c){this.setDomainDataItem(b,c,a.AppDomain)}},{key:"getAppDataItem",value:function(b){return this.getDomainDataItem(b,a.AppDomain)}},{key:"hasRawClientUpdatedAtValue",value:function(){return null!=this.getAppDataItem("client_updated_at")}},{key:"keysToIgnoreWhenCheckingContentEquality",value:function(){return[]}},{key:"appDataKeysToIgnoreWhenCheckingContentEquality",value:function(){return["client_updated_at"]}},{key:"isItemContentEqualWith",value:function(b){var c=function(a,b){if(!a)return a;var c=!0,d=!1,e=void 0;try{for(var f,g=b[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){delete a[f.value]}}catch(a){d=!0,e=a}finally{try{!c&&g.return&&g.return()}finally{if(d)throw e}}return a},d=this.structureParams();d.appData[a.AppDomain]=c(d.appData[a.AppDomain],this.appDataKeysToIgnoreWhenCheckingContentEquality()),d=c(d,this.keysToIgnoreWhenCheckingContentEquality());var e=b.structureParams();return e.appData[a.AppDomain]=c(e.appData[a.AppDomain],b.appDataKeysToIgnoreWhenCheckingContentEquality()),e=c(e,b.keysToIgnoreWhenCheckingContentEquality()),JSON.stringify(d)===JSON.stringify(e)}},{key:"satisfiesPredicate",value:function(a){return w.ItemSatisfiesPredicate(this,a)}},{key:"createdAtString",value:function(){return this.dateToLocalizedString(this.created_at)}},{key:"updatedAtString",value:function(){return this.dateToLocalizedString(this.client_updated_at)}},{key:"dateToLocalizedString",value:function(a){if("undefined"!=typeof Intl&&Intl.DateTimeFormat){if(!h){var b=navigator.languages&&navigator.languages.length?navigator.languages[0]:navigator.language;h=new Intl.DateTimeFormat(b,{year:"numeric",month:"short",day:"2-digit",weekday:"long",hour:"2-digit",minute:"2-digit"})}return h.format(a)}return a.toDateString()+" "+a.toLocaleTimeString()}},{key:"contentObject",get:function(){if(!this.content)return this.content={},this.content;if(null!==this.content&&"object"===j(this.content))return this.content;try{var a=JSON.parse(this.content);return this.content=a,this.content}catch(a){return console.log("Error parsing json",a,this),this.content={},this.content}}},{key:"pinned",get:function(){return this.getAppDataItem("pinned")}},{key:"archived",get:function(){return this.getAppDataItem("archived")}},{key:"locked",get:function(){return this.getAppDataItem("locked")}},{key:"displayName",get:function(){return"Item"}},{key:"client_updated_at",get:function(){if(!this._client_updated_at){var a=this.getAppDataItem("client_updated_at");this._client_updated_at=a?new Date(a):new Date(this.updated_at)}return this._client_updated_at},set:function(a){this._client_updated_at=a,this.setAppDataItem("client_updated_at",a)}}],[{key:"sortItemsByDate",value:function(a){a.sort(function(a,b){return new Date(b.created_at)-new Date(a.created_at)})}},{key:"deepMerge",value:function(a,b){function c(a,b){if(_.isArray(a))return b}return _.mergeWith(a,b,c),a}}]),a}(),v=c.SFItemParams=function(){function a(b,c,d){if(f(this,a),this.item=b,this.keys=c,this.auth_params=d,this.keys&&!this.auth_params)throw"SFItemParams.auth_params must be supplied if supplying keys.";if(this.auth_params&&!this.auth_params.version)throw"SFItemParams.auth_params is missing version"}return k(a,[{key:"paramsForExportFile",value:function(){function a(a){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(b){var c;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(this.additionalFields=["updated_at"],this.forExportFile=!0,!b){a.next=6;break}return a.abrupt("return",this.__params());case 6:return a.next=8,this.__params();case 8:return c=a.sent,a.abrupt("return",_.omit(c,["deleted"]));case 10:case"end":return a.stop()}},a,this)}));return a}()},{key:"paramsForExtension",value:function(){function a(){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",this.paramsForExportFile());case 1:case"end":return a.stop()}},a,this)}));return a}()},{key:"paramsForLocalStorage",value:function(){function a(){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return this.additionalFields=["updated_at","dirty","errorDecrypting"],this.forExportFile=!0,a.abrupt("return",this.__params());case 3:case"end":return a.stop()}},a,this)}));return a}()},{key:"paramsForSync",value:function(){function a(){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",this.__params());case 1:case"end":return a.stop()}},a,this)}));return a}()},{key:"__params",value:function(){function a(){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(){var b,c,d;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(b={uuid:this.item.uuid,content_type:this.item.content_type,deleted:this.item.deleted,created_at:this.item.created_at},this.item.errorDecrypting){a.next=23;break}if(c=this.item.doNotEncrypt()&&!this.forExportFile,!this.keys||c){a.next=11;break}return a.next=6,SFJS.itemTransformer.encryptItem(this.item,this.keys,this.auth_params);case 6:d=a.sent,_.merge(b,d),"001"!==this.auth_params.version&&(b.auth_hash=null),a.next=21;break;case 11:if(!this.forExportFile){a.next=15;break}a.t0=this.item.createContentJSONFromProperties(),a.next=19;break;case 15:return a.next=17,SFJS.crypto.base64(JSON.stringify(this.item.createContentJSONFromProperties()));case 17:a.t1=a.sent,a.t0="000"+a.t1;case 19:b.content=a.t0,this.forExportFile||(b.enc_item_key=null,b.auth_hash=null);case 21:a.next=26;break;case 23:b.content=this.item.content,b.enc_item_key=this.item.enc_item_key,b.auth_hash=this.item.auth_hash;case 26:return this.additionalFields&&_.merge(b,_.pick(this.item,this.additionalFields)),a.abrupt("return",b);case 28:case"end":return a.stop()}},a,this)}));return a}()}]),a}(),w=c.SFPredicate=function(){function a(b,c,d){f(this,a),this.keypath=b,this.operator=c,this.value=d}return k(a,null,[{key:"fromArray",value:function(b){var c=new a;return c.keypath=b[0],c.operator=b[1],c.value=b[2],c}},{key:"ObjectSatisfiesPredicate",value:function(a,b){var c=b.keypath.split(".").reduce(function(a,b){return a&&a[b]},a),d=b.value;"string"==typeof d&&d.includes(".ago")&&(d=this.DateFromString(d));var e=[!1,"",null,void 0,NaN];if(void 0==c)return e.includes(b.value);if("="==b.operator)return Array.isArray(c)?JSON.stringify(c)==JSON.stringify(d):c==d;if("<"==b.operator)return c<d;if(">"==b.operator)return c>d;if("<="==b.operator)return c<=d;if(">="==b.operator)return c>=d;if("startsWith"==b.operator)return c.startsWith(d);if("in"==b.operator)return-1!=d.indexOf(c);if("includes"==b.operator)return this.resolveIncludesPredicate(c,d);if("matches"==b.operator){return new RegExp(d).test(c)}return!1}},{key:"resolveIncludesPredicate",value:function(b,c){if("string"==typeof c)return b.includes(c);var d;d=Array.isArray(c)?a.fromArray(c):c;var e=!0,f=!1,g=void 0;try{for(var h,i=b[Symbol.iterator]();!(e=(h=i.next()).done);e=!0){var j=h.value;if(this.ObjectSatisfiesPredicate(j,d))return!0}}catch(a){f=!0,g=a}finally{try{!e&&i.return&&i.return()}finally{if(f)throw g}}return!1}},{key:"ItemSatisfiesPredicate",value:function(b,c){return Array.isArray(c)&&(c=a.fromArray(c)),this.ObjectSatisfiesPredicate(b,c)}},{key:"DateFromString",value:function(a){var b=a.split("."),c=b[1],d=new Date,e=parseInt(b[0]);return"days"==c?d.setDate(d.getDate()-e):"hours"==c&&d.setHours(d.getHours()-e),d}}]),a}(),x=c.SFHistorySession=function(a){function c(a){f(this,c);var d=b(this,(c.__proto__||Object.getPrototypeOf(c)).call(this,a));return d.content.itemUUIDToItemHistoryMapping||(d.content.itemUUIDToItemHistoryMapping={}),Object.keys(d.content.itemUUIDToItemHistoryMapping).forEach(function(a){var b=d.content.itemUUIDToItemHistoryMapping[a];d.content.itemUUIDToItemHistoryMapping[a]=new y(b)}),d}return d(c,a),k(c,[{key:"addEntryForItem",value:function(a){return this.historyForItem(a).addHistoryEntryForItem(a)}},{key:"historyForItem",value:function(a){var b=this.content.itemUUIDToItemHistoryMapping[a.uuid];return b||(b=this.content.itemUUIDToItemHistoryMapping[a.uuid]=new y),b}},{key:"clearItemHistory",value:function(a){this.historyForItem(a).clear()}},{key:"clearAllHistory",value:function(){this.content.itemUUIDToItemHistoryMapping={}}},{key:"optimizeHistoryForItem",value:function(a){var b=this.historyForItem(a);b.entries.length>c.LargeItemEntryAmountThreshold&&b.optimize()}}]),c}(u);x.LargeItemEntryAmountThreshold=60;var y=c.SFItemHistory=function(){function a(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(f(this,a),this.entries||(this.entries=[]),b.entries){var c=!0,d=!1,e=void 0;try{for(var g,h=b.entries[Symbol.iterator]();!(c=(g=h.next()).done);c=!0){var i=g.value,j=this.createEntryForItem(i.item);j.setPreviousEntry(this.getLastEntry()),this.entries.push(j)}}catch(a){d=!0,e=a}finally{try{!c&&h.return&&h.return()}finally{if(d)throw e}}}}return k(a,[{key:"createEntryForItem",value:function(b){var c=a.HistoryEntryClassMapping&&a.HistoryEntryClassMapping[b.content_type];return c||(c=z),new c(b)}},{key:"getLastEntry",value:function(){return this.entries[this.entries.length-1]}},{key:"addHistoryEntryForItem",value:function(a){var b=this.createEntryForItem(a),c=this.getLastEntry();if(b.setPreviousEntry(c),!b.isSameAsEntry(c))return this.entries.push(b),b}},{key:"clear",value:function(){this.entries.length=0}},{key:"optimize",value:function(){var b=this,c=[],d=function(b){return b.deltaSize()>a.LargeEntryDeltaThreshold},e=function(a,e,f){if(f)c.push(a);else{var e=c.indexOf(a);-1!==e&&c.splice(e,1)}if(f&&d(a)&&-1==a.operationVector()){var g=b.entries[e-1];g&&c.push(g)}};this.entries.forEach(function(a,c){if(0==c||c==b.entries.length-1)e(a,c,!0);else{var f=d(a);e(a,c,f)}}),this.entries=this.entries.filter(function(a,b){return-1!==c.indexOf(a)})}}]),a}();y.LargeEntryDeltaThreshold=15;var z=c.SFItemHistoryEntry=function(){function a(b){f(this,a),this.item=u.deepMerge({},b),this.defaultContentKeyToDiffOn="text",this.textCharDiffLength=0,"string"==typeof this.item.updated_at&&(this.item.updated_at=new Date(this.item.updated_at))}return k(a,[{key:"setPreviousEntry",value:function(a){this.hasPreviousEntry=null!=a,this.item.content[this.defaultContentKeyToDiffOn]&&(this.textCharDiffLength=a?this.item.content[this.defaultContentKeyToDiffOn].length-a.item.content[this.defaultContentKeyToDiffOn].length:this.item.content[this.defaultContentKeyToDiffOn].length)}},{key:"operationVector",value:function(){return void 0!=this.textCharDiffLength?this.hasPreviousEntry&&0!=this.textCharDiffLength?this.textCharDiffLength<0?-1:1:0:1}},{key:"deltaSize",value:function(){return void 0!=this.textCharDiffLength?Math.abs(this.textCharDiffLength):1}},{key:"isSameAsEntry",value:function(a){if(!a)return!1;var b=new u(this.item),c=new u(a.item);return b.isItemContentEqualWith(c)}}]),a}(),n="undefined"!=typeof window?window:void 0!==a?a:null,A=c.SFAbstractCrypto=function(){function a(){f(this,a),this.DefaultPBKDF2Length=768}return k(a,[{key:"generateUUIDSync",value:function(){var a=n.crypto||n.msCrypto;if(a){var b=new Uint32Array(4);a.getRandomValues(b);var c=-1;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){c++;var d=b[c>>3]>>c%8*4&15;return("x"==a?d:3&d|8).toString(16)})}var d=(new Date).getTime();return n.performance&&"function"==typeof n.performance.now&&(d+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=(d+16*Math.random())%16|0;return d=Math.floor(d/16),("x"==a?b:3&b|8).toString(16)})}},{key:"generateUUID",value:function(){function a(){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",this.generateUUIDSync());case 1:case"end":return a.stop()}},a,this)}));return a}()},{key:"decryptText",value:function(){function a(){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(){var b,c,d,e,f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},h=f.ciphertextToAuth,i=f.contentCiphertext,j=f.encryptionKey,k=f.iv,l=f.authHash,m=f.authKey,n=arguments[1];return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!n||l){a.next=3;break}return console.error("Auth hash is required."),a.abrupt("return");case 3:if(!l){a.next=10;break}return a.next=6,this.hmac256(h,m);case 6:if(b=a.sent,l===b){a.next=10;break}return console.error("Auth hash does not match, returning null."),a.abrupt("return",null);case 10:return c=g.enc.Hex.parse(j),d=g.enc.Hex.parse(k||""),e=g.AES.decrypt(i,c,{iv:d,mode:g.mode.CBC,padding:g.pad.Pkcs7}),a.abrupt("return",e.toString(g.enc.Utf8));case 14:case"end":return a.stop()}},a,this)}));return a}()},{key:"encryptText",value:function(){function a(a,c,d){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(b,c,d){var e,f,h;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return e=g.enc.Hex.parse(c),f=g.enc.Hex.parse(d||""),h=g.AES.encrypt(b,e,{iv:f,mode:g.mode.CBC,padding:g.pad.Pkcs7}),a.abrupt("return",h.toString());case 4:case"end":return a.stop()}},a,this)}));return a}()},{key:"generateRandomKey",value:function(){function a(a){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(b){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",g.lib.WordArray.random(b/8).toString());case 1:case"end":return a.stop()}},a,this)}));return a}()},{key:"generateItemEncryptionKey",value:function(){function a(){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(){var b,c,d,e;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return b=512,c=1,a.next=4,this.generateRandomKey(b);case 4:return d=a.sent,a.next=7,this.generateRandomKey(b);case 7:return e=a.sent,a.abrupt("return",this.pbkdf2(e,d,c,b));case 9:case"end":return a.stop()}},a,this)}));return a}()},{key:"firstHalfOfKey",value:function(){function a(a){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(b){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",b.substring(0,b.length/2));case 1:case"end":return a.stop()}},a,this)}));return a}()},{key:"secondHalfOfKey",value:function(){function a(a){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(b){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",b.substring(b.length/2,b.length));case 1:case"end":return a.stop()}},a,this)}));return a}()},{key:"base64",value:function(){function a(a){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(b){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",n.btoa(encodeURIComponent(b).replace(/%([0-9A-F]{2})/g,function(a,b){return String.fromCharCode("0x"+b)})));case 1:case"end":return a.stop()}},a,this)}));return a}()},{key:"base64Decode",value:function(){function a(a){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(b){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",n.atob(b));case 1:case"end":return a.stop()}},a,this)}));return a}()},{key:"sha256",value:function(){function a(a){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(b){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",g.SHA256(b).toString());case 1:case"end":return a.stop()}},a,this)}));return a}()},{key:"hmac256",value:function(){function a(a,c){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(b,c){var d,e,f;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return d=g.enc.Hex.parse(c),e=g.enc.Utf8.parse(b),f=g.HmacSHA256(e,d).toString(),a.abrupt("return",f);case 4:case"end":return a.stop()}},a,this)}));return a}()},{key:"generateSalt",value:function(){function a(a,c,d,e){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(b,c,d,e){var f;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.sha256([b,"SF",c,d,e].join(":"));case 2:return f=a.sent,a.abrupt("return",f);case 4:case"end":return a.stop()}},a,this)}));return a}()},{key:"generateSymmetricKeyPair",value:function(){function a(){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(){var b,c,d,e,f,g,h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=h.password,j=h.pw_salt,k=h.pw_cost;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.pbkdf2(i,j,k,this.DefaultPBKDF2Length);case 2:return b=a.sent,c=b.length,d=c/3,e=b.slice(0,d),f=b.slice(d,2*d),g=b.slice(2*d,3*d),a.abrupt("return",[e,f,g]);case 9:case"end":return a.stop()}},a,this)}));return a}()},{key:"computeEncryptionKeysForUser",value:function(){function a(a,c){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(b,c){var d;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if("003"!=c.version){a.next=9;break}if(c.identifier){a.next=4;break}return console.error("authParams is missing identifier."),a.abrupt("return");case 4:return a.next=6,this.generateSalt(c.identifier,c.version,c.pw_cost,c.pw_nonce);case 6:d=a.sent,a.next=10;break;case 9:d=c.pw_salt;case 10:return a.abrupt("return",this.generateSymmetricKeyPair({password:b,pw_salt:d,pw_cost:c.pw_cost}).then(function(a){return{pw:a[0],mk:a[1],ak:a[2]}}));case 11:case"end":return a.stop()}},a,this)}));return a}()},{key:"generateInitialKeysAndAuthParamsForUser",value:function(){function a(a,c){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(b,c){var d,e,f,g;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return d=this.SFJS.version,e=this.SFJS.defaultPasswordGenerationCost,a.next=4,this.generateRandomKey(256);case 4:return f=a.sent,a.next=7,this.generateSalt(b,d,e,f);case 7:return g=a.sent,a.abrupt("return",this.generateSymmetricKeyPair({password:c,pw_salt:g,pw_cost:e}).then(function(a){var c={pw_nonce:f,pw_cost:e,identifier:b,version:d};return{keys:{pw:a[0],mk:a[1],ak:a[2]},authParams:c}}));case 9:case"end":return a.stop()}},a,this)}));return a}()}]),a}(),B=c.SFCryptoJS=function(a){function c(){return f(this,c),b(this,(c.__proto__||Object.getPrototypeOf(c)).apply(this,arguments))}return d(c,a),k(c,[{key:"pbkdf2",value:function(){function a(a,c,d,e){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(b,c,d,e){var f;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return f={keySize:e/32,hasher:g.algo.SHA512,iterations:d},a.abrupt("return",g.PBKDF2(b,c,f).toString());case 2:case"end":return a.stop()}},a,this)}));return a}()}]),c}(A),n="undefined"!=typeof window?window:void 0!==a?a:null,C=n.crypto?n.crypto.subtle:null,D=c.SFCryptoWeb=function(a){function c(){return f(this,c),b(this,(c.__proto__||Object.getPrototypeOf(c)).apply(this,arguments))}return d(c,a),k(c,[{key:"pbkdf2",value:function(){function a(a,c,d,e){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(b,c,d,e){var f;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.webCryptoImportKey(b,"PBKDF2",["deriveBits"]);case 2:if(f=a.sent){a.next=6;break}return console.log("Key is null, unable to continue"),a.abrupt("return",null);case 6:return a.abrupt("return",this.webCryptoDeriveBits(f,c,d,e));case 7:case"end":return a.stop()}},a,this)}));return a}()},{key:"generateRandomKey",value:function(){function a(a){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(b){var c,d=this;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return c=!0,a.abrupt("return",C.generateKey({name:"AES-CBC",length:b},c,["encrypt","decrypt"]).then(function(a){return C.exportKey("raw",a).then(function(){var a=e(regeneratorRuntime.mark(function a(b){var c;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,d.arrayBufferToHexString(new Uint8Array(b));case 2:return c=a.sent,a.abrupt("return",c);case 4:case"end":return a.stop()}},a,d)}));return function(b){return a.apply(this,arguments)}}()).catch(function(a){console.error("Error exporting key",a)})}).catch(function(a){console.error("Error generating key",a)}));case 2:case"end":return a.stop()}},a,this)}));return a}()},{key:"generateItemEncryptionKey",value:function(){function a(){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(){var b;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return b=256,a.abrupt("return",Promise.all([this.generateRandomKey(b),this.generateRandomKey(b)]).then(function(a){return a.join("")}));case 2:case"end":return a.stop()}},a,this)}))
;return a}()},{key:"encryptText",value:function(){function a(a,c,d){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(b,c,d){var f,g,h,i,j,k=this;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.hexStringToArrayBuffer(d);case 2:return f=a.sent,g={name:"AES-CBC",iv:f},a.next=6,this.hexStringToArrayBuffer(c);case 6:return h=a.sent,a.next=9,this.webCryptoImportKey(h,g.name,["encrypt"]);case 9:return i=a.sent,a.next=12,this.stringToArrayBuffer(b);case 12:return j=a.sent,a.abrupt("return",crypto.subtle.encrypt(g,i,j).then(function(){var a=e(regeneratorRuntime.mark(function a(b){var c;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,k.arrayBufferToBase64(b);case 2:return c=a.sent,a.abrupt("return",c);case 4:case"end":return a.stop()}},a,k)}));return function(b){return a.apply(this,arguments)}}()));case 14:case"end":return a.stop()}},a,this)}));return a}()},{key:"decryptText",value:function(){function a(){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(){var b,c,d,f,g,h,i=this,j=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},k=j.ciphertextToAuth,l=j.contentCiphertext,m=j.encryptionKey,n=j.iv,o=j.authHash,p=j.authKey,q=arguments[1];return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!q||o){a.next=3;break}return console.error("Auth hash is required."),a.abrupt("return");case 3:if(!o){a.next=10;break}return a.next=6,this.hmac256(k,p);case 6:if(b=a.sent,o===b){a.next=10;break}return console.error("Auth hash does not match, returning null. "+o+" != "+b),a.abrupt("return",null);case 10:return a.next=12,this.hexStringToArrayBuffer(n);case 12:return c=a.sent,d={name:"AES-CBC",iv:c},a.next=16,this.hexStringToArrayBuffer(m);case 16:return f=a.sent,a.next=19,this.webCryptoImportKey(f,d.name,["decrypt"]);case 19:return g=a.sent,a.next=22,this.base64ToArrayBuffer(l);case 22:return h=a.sent,a.abrupt("return",crypto.subtle.decrypt(d,g,h).then(function(){var a=e(regeneratorRuntime.mark(function a(b){var c;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,i.arrayBufferToString(b);case 2:return c=a.sent,a.abrupt("return",c);case 4:case"end":return a.stop()}},a,i)}));return function(b){return a.apply(this,arguments)}}()).catch(function(a){console.error("Error decrypting:",a)}));case 24:case"end":return a.stop()}},a,this)}));return a}()},{key:"webCryptoImportKey",value:function(){function a(a,c,d,e){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(b,c,d,e){var f;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if("string"!=typeof b){a.next=6;break}return a.next=3,this.stringToArrayBuffer(b);case 3:a.t0=a.sent,a.next=7;break;case 6:a.t0=b;case 7:return f=a.t0,a.abrupt("return",C.importKey("raw",f,{name:c,hash:e},!1,d).then(function(a){return a}).catch(function(a){return console.error(a),null}));case 9:case"end":return a.stop()}},a,this)}));return a}()},{key:"webCryptoDeriveBits",value:function(){function a(a,c,d,e){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(b,c,d,f){var g,h=this;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.stringToArrayBuffer(c);case 2:return a.t0=a.sent,a.t1=d,a.t2={name:"SHA-512"},g={name:"PBKDF2",salt:a.t0,iterations:a.t1,hash:a.t2},a.abrupt("return",C.deriveBits(g,b,f).then(function(){var a=e(regeneratorRuntime.mark(function a(b){var c;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,h.arrayBufferToHexString(new Uint8Array(b));case 2:return c=a.sent,a.abrupt("return",c);case 4:case"end":return a.stop()}},a,h)}));return function(b){return a.apply(this,arguments)}}()).catch(function(a){return console.error(a),null}));case 7:case"end":return a.stop()}},a,this)}));return a}()},{key:"stringToArrayBuffer",value:function(){function a(a){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(b){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",new Promise(function(a,c){var d=new Blob([b]),e=new FileReader;e.onload=function(b){a(b.target.result)},e.readAsArrayBuffer(d)}));case 1:case"end":return a.stop()}},a,this)}));return a}()},{key:"arrayBufferToString",value:function(){function a(a){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(b){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",new Promise(function(a,c){var d=new Blob([b]),e=new FileReader;e.onload=function(b){a(b.target.result)},e.readAsText(d)}));case 1:case"end":return a.stop()}},a,this)}));return a}()},{key:"arrayBufferToHexString",value:function(){function a(a){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(b){var c,d,e,f;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:for(c=new Uint8Array(b),d="",f=0;f<c.byteLength;f++)e=c[f].toString(16),e.length<2&&(e="0"+e),d+=e;return a.abrupt("return",d);case 4:case"end":return a.stop()}},a,this)}));return a}()},{key:"hexStringToArrayBuffer",value:function(){function a(a){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(b){var c,d;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:for(c=[],d=0;d<b.length;d+=2)c.push(parseInt(b.substr(d,2),16));return a.abrupt("return",new Uint8Array(c));case 2:case"end":return a.stop()}},a,this)}));return a}()},{key:"base64ToArrayBuffer",value:function(){function a(a){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(b){var c,d,e,f;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.base64Decode(b);case 2:for(c=a.sent,d=c.length,e=new Uint8Array(d),f=0;f<d;f++)e[f]=c.charCodeAt(f);return a.abrupt("return",e.buffer);case 7:case"end":return a.stop()}},a,this)}));return a}()},{key:"arrayBufferToBase64",value:function(){function a(a){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(b){return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",new Promise(function(a,c){var d=new Blob([b],{type:"application/octet-binary"}),e=new FileReader;e.onload=function(b){var c=b.target.result;a(c.substr(c.indexOf(",")+1))},e.readAsDataURL(d)}));case 1:case"end":return a.stop()}},a,this)}));return a}()},{key:"hmac256",value:function(){function a(a,c){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(b,c){var d,f,g,h=this;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.hexStringToArrayBuffer(c);case 2:return d=a.sent,a.next=5,this.webCryptoImportKey(d,"HMAC",["sign"],{name:"SHA-256"});case 5:return f=a.sent,a.next=8,this.stringToArrayBuffer(b);case 8:return g=a.sent,a.abrupt("return",crypto.subtle.sign({name:"HMAC"},f,g).then(function(){var a=e(regeneratorRuntime.mark(function a(b){var c;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,h.arrayBufferToHexString(b);case 2:return c=a.sent,a.abrupt("return",c);case 4:case"end":return a.stop()}},a,h)}));return function(b){return a.apply(this,arguments)}}()).catch(function(a){console.error("Error computing hmac")}));case 10:case"end":return a.stop()}},a,this)}));return a}()}]),c}(A),E=c.SFItemTransformer=function(){function a(b){f(this,a),this.crypto=b}return k(a,[{key:"_private_encryptString",value:function(){function a(a,c,d,e,f){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(b,c,d,e,f){var g,h,i,j,k,l;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if("001"!==f.version){a.next=7;break}return a.next=3,this.crypto.encryptText(b,c,null);case 3:h=a.sent,g=f.version+h,a.next=21;break;case 7:return a.next=9,this.crypto.generateRandomKey(128);case 9:return i=a.sent,a.next=12,this.crypto.encryptText(b,c,i);case 12:return h=a.sent,j=[f.version,e,i,h].join(":"),a.next=16,this.crypto.hmac256(j,d);case 16:return k=a.sent,a.next=19,this.crypto.base64(JSON.stringify(f));case 19:l=a.sent,g=[f.version,k,e,i,h,l].join(":");case 21:return a.abrupt("return",g);case 22:case"end":return a.stop()}},a,this)}));return a}()},{key:"encryptItem",value:function(){function a(a,c,d){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(b,c,d){var e,f,g,h,i,j;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return e={},a.next=3,this.crypto.generateItemEncryptionKey();case 3:if(f=a.sent,"001"!==d.version){a.next=10;break}return a.next=7,this.crypto.encryptText(f,c.mk,null);case 7:e.enc_item_key=a.sent,a.next=13;break;case 10:return a.next=12,this._private_encryptString(f,c.mk,c.ak,b.uuid,d);case 12:e.enc_item_key=a.sent;case 13:return a.next=15,this.crypto.firstHalfOfKey(f);case 15:return g=a.sent,a.next=18,this.crypto.secondHalfOfKey(f);case 18:return h=a.sent,a.next=21,this._private_encryptString(JSON.stringify(b.createContentJSONFromProperties()),g,h,b.uuid,d);case 21:if(i=a.sent,"001"!==d.version){a.next=27;break}return a.next=25,this.crypto.hmac256(i,h);case 25:j=a.sent,e.auth_hash=j;case 27:return e.content=i,a.abrupt("return",e);case 29:case"end":return a.stop()}},a,this)}));return a}()},{key:"encryptionComponentsFromString",value:function(a,b,c){var d=a.substring(0,3);if("001"===d)return{contentCiphertext:a.substring(3,a.length),encryptionVersion:d,ciphertextToAuth:a,iv:null,authHash:null,encryptionKey:b,authKey:c};var e=a.split(":");return{encryptionVersion:e[0],authHash:e[1],uuid:e[2],iv:e[3],contentCiphertext:e[4],authParams:e[5],ciphertextToAuth:[e[0],e[2],e[3],e[4]].join(":"),encryptionKey:b,authKey:c}}},{key:"decryptItem",value:function(){function a(a,c){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(b,c){var d,e,f,g,h,i,j,k;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if("string"==typeof b.content){a.next=2;break}return a.abrupt("return");case 2:if(!b.content.startsWith("000")){a.next=14;break}return a.prev=3,a.t0=JSON,a.next=7,this.crypto.base64Decode(b.content.substring(3,b.content.length));case 7:a.t1=a.sent,b.content=a.t0.parse.call(a.t0,a.t1),a.next=13;break;case 11:a.prev=11,a.t2=a.catch(3);case 13:return a.abrupt("return");case 14:if(b.enc_item_key){a.next=17;break}return console.log("Missing item encryption key, skipping decryption."),a.abrupt("return");case 17:if(d=b.enc_item_key,e=!0,d.startsWith("002")||d.startsWith("003")||(d="001"+d,e=!1),f=this.encryptionComponentsFromString(d,c.mk,c.ak),!f.uuid||f.uuid===b.uuid){a.next=26;break}return console.error("Item key params UUID does not match item UUID"),b.errorDecrypting||(b.errorDecryptingValueChanged=!0),b.errorDecrypting=!0,a.abrupt("return");case 26:return a.next=28,this.crypto.decryptText(f,e);case 28:if(g=a.sent){a.next=34;break}return console.log("Error decrypting item",b),b.errorDecrypting||(b.errorDecryptingValueChanged=!0),b.errorDecrypting=!0,a.abrupt("return");case 34:return a.next=36,this.crypto.firstHalfOfKey(g);case 36:return h=a.sent,a.next=39,this.crypto.secondHalfOfKey(g);case 39:return i=a.sent,j=this.encryptionComponentsFromString(b.content,h,i),a.prev=41,a.t3=JSON,a.next=45,this.crypto.base64Decode(j.authParams);case 45:a.t4=a.sent,b.auth_params=a.t3.parse.call(a.t3,a.t4),a.next=51;break;case 49:a.prev=49,a.t5=a.catch(41);case 51:if(!j.uuid||j.uuid===b.uuid){a.next=55;break}return b.errorDecrypting||(b.errorDecryptingValueChanged=!0),b.errorDecrypting=!0,a.abrupt("return");case 55:return j.authHash||(j.authHash=b.auth_hash),a.next=58,this.crypto.decryptText(j,!0);case 58:k=a.sent,k?(1==b.errorDecrypting&&(b.errorDecryptingValueChanged=!0),b.errorDecrypting=!1,b.content=k):(b.errorDecrypting||(b.errorDecryptingValueChanged=!0),b.errorDecrypting=!0);case 60:case"end":return a.stop()}},a,this,[[3,11],[41,49]])}));return a}()},{key:"decryptMultipleItems",value:function(){function a(a,c,d){return b.apply(this,arguments)}var b=e(regeneratorRuntime.mark(function a(b,c,d){var f,g=this;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return f=function(){var a=e(regeneratorRuntime.mark(function a(b){var e;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(b){a.next=2;break}return a.abrupt("return");case 2:if(1!=b.deleted||null!=b.content){a.next=4;break}return a.abrupt("return");case 4:if(!(e="string"==typeof b.content||b.content instanceof String)){a.next=19;break}return a.prev=6,a.next=9,g.decryptItem(b,c);case 9:a.next=19;break;case 11:if(a.prev=11,a.t0=a.catch(6),b.errorDecrypting||(b.errorDecryptingValueChanged=!0),b.errorDecrypting=!0,!d){a.next=17;break}throw a.t0;case 17:return console.error("Error decrypting item",b,a.t0),a.abrupt("return");case 19:case"end":return a.stop()}},a,g,[[6,11]])}));return function(b){return a.apply(this,arguments)}}(),a.abrupt("return",Promise.all(b.map(function(a){return f(a)})));case 2:case"end":return a.stop()}},a,this)}));return a}()}]),a}(),n="undefined"!=typeof window?window:void 0!==a?a:null,F=c.StandardFile=function(){function a(b){if(f(this,a),n){!("undefined"!=typeof document&&document.documentMode||/Edge/.test(navigator.userAgent))&&n.crypto&&n.crypto.subtle?this.crypto=new D:this.crypto=new B}b&&(this.crypto=b),this.itemTransformer=new E(this.crypto),this.crypto.SFJS={version:this.version(),defaultPasswordGenerationCost:this.defaultPasswordGenerationCost()}}return k(a,[{key:"version",value:function(){return"003"}},{key:"supportsPasswordDerivationCost",value:function(a){return!(a>5e3)||this.crypto instanceof D}},{key:"supportedVersions",value:function(){return["001","002","003"]}},{key:"isVersionNewerThanLibraryVersion",value:function(a){var b=this.version();return parseInt(a)>parseInt(b)}},{key:"isProtocolVersionOutdated",value:function(a){var b={"001":Date.parse("2018-01-01"),"002":Date.parse("2020-01-01")},c=b[a];return!!c&&new Date>c}},{key:"costMinimumForVersion",value:function(a){return{"001":3e3,"002":3e3,"003":11e4}[a]}},{key:"defaultPasswordGenerationCost",value:function(){return this.costMinimumForVersion(this.version())}}]),a}();if(n)try{n.StandardFile=F,n.SFJS=new F,n.SFCryptoWeb=D,n.SFCryptoJS=B,n.SFItemTransformer=E,n.SFModelManager=q,n.SFItem=u,n.SFItemParams=v,n.SFHttpManager=o,n.SFStorageManager=s,n.SFSyncManager=t,n.SFAuthManager=m,n.SFMigrationManager=p,n.SFAlertManager=l,n.SFPredicate=w,n.SFHistorySession=x,n.SFSessionHistoryManager=r,n.SFItemHistory=y,n.SFItemHistoryEntry=z}catch(a){console.log("Exception while exporting window variables",a)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1])(1)});